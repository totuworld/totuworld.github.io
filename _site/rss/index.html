<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>totuworld&#39;s tech blog</title>
    <description>Full 🥩🔥 Developer</description>
    <link />https://blog.totu.dev/&lt;/link&gt;
    <atom:link href="https://blog.totu.dev/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Wed, 24 Apr 2019 14:23:28 +0900</pubDate>
    <lastBuildDate>Wed, 24 Apr 2019 14:23:28 +0900</lastBuildDate>
    <generator>Jekyll v3.1.2</generator>
    
      
        <item>
            <title>슬랙 봇부터 시작하는 프로그래밍 생활 - 01</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#준비하기&quot; id=&quot;markdown-toc-준비하기&quot;&gt;준비하기&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#nodejs-설치feat-nvs&quot; id=&quot;markdown-toc-nodejs-설치feat-nvs&quot;&gt;node.js 설치(feat. NVS)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#vs-code-설치&quot; id=&quot;markdown-toc-vs-code-설치&quot;&gt;VS Code 설치&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#작업-공간-연성&quot; id=&quot;markdown-toc-작업-공간-연성&quot;&gt;작업 공간 연성&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#슬랙-봇-만들기&quot; id=&quot;markdown-toc-슬랙-봇-만들기&quot;&gt;슬랙 봇 만들기&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#안녕하고-인사하는-슬랙-봇-살펴보기&quot; id=&quot;markdown-toc-안녕하고-인사하는-슬랙-봇-살펴보기&quot;&gt;안녕하고 인사하는 슬랙 봇 살펴보기&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#typescript-코드로-변경하기&quot; id=&quot;markdown-toc-typescript-코드로-변경하기&quot;&gt;TypeScript 코드로 변경하기&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#코드-실행해보기&quot; id=&quot;markdown-toc-코드-실행해보기&quot;&gt;코드 실행해보기&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#src-폴더와-serverts-파일-만들기&quot; id=&quot;markdown-toc-src-폴더와-serverts-파일-만들기&quot;&gt;src 폴더와 server.ts 파일 만들기&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#코드-붙여넣고-실행하기&quot; id=&quot;markdown-toc-코드-붙여넣고-실행하기&quot;&gt;코드 붙여넣고 실행하기&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#패키지-설치&quot; id=&quot;markdown-toc-패키지-설치&quot;&gt;패키지 설치&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#slack-토큰-발급받기&quot; id=&quot;markdown-toc-slack-토큰-발급받기&quot;&gt;slack 토큰 발급받기&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#결과-확인&quot; id=&quot;markdown-toc-결과-확인&quot;&gt;결과 확인&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#맺는-말&quot; id=&quot;markdown-toc-맺는-말&quot;&gt;맺는 말&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;

&lt;p&gt;프로그래밍은 기초가 중요하다. &lt;del&gt;세상에 기초가 안중요한 것도 있나&lt;/del&gt; 나는 기초가 얼마나 재미없는지 알고 있다. 맨주먹으로 슬랙 봇부터 시도해보자.&lt;/p&gt;

&lt;h2 id=&quot;준비하기&quot;&gt;준비하기&lt;/h2&gt;
&lt;p&gt;안타깝게도 아무것도 없이 맨주먹으로 시작하려고 해도 node.js와 VS Code는 필요하다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Node.js®는 Chrome V8 JavaScript 엔진으로 빌드된 JavaScript 런타임.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;VS Code는 마이크로 소프트 사가 오픈소스로 배포하는 에디터.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;nodejs-설치feat-nvs&quot;&gt;node.js 설치(feat. NVS)&lt;/h3&gt;

&lt;p&gt;설치 방법은 여러가지가 있지만 NVS(Node Version Switcher)를 활용해서 node.js를 사용하도록 하겠다. 터미널(Terminal)&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;을 열고 아래 명령을 복붙하여 입력하고 실행한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;macOS에서 &lt;code&gt;터미널&lt;/code&gt;로 검색하면 된다. 만약 &lt;a href=&quot;https://www.iterm2.com/&quot;&gt;iTerm2&lt;/a&gt;를 설치했다면 iTerm을 활용해도 좋다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code&gt;export NVS_HOME=&quot;$HOME/.nvs&quot;
git clone https://github.com/jasongin/nvs &quot;$NVS_HOME&quot;
. &quot;$NVS_HOME/nvs.sh&quot; install
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;뭔지 모르겠지만 이러면 뭔가 설치된다. node.js v10.15를 활용해야하므로 아래 명령을 순서대로 터미널에 입력한다.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;nvs add node/10.15
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;v10.15을 nvs로 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;nvs use node/10.15
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;v10.15를 사용하도록 한다.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;nvs link
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;앞으로 어디서 켜도 nvs가 node.js v10.15를 쓰도록 설정한다.&lt;/p&gt;

&lt;p&gt;어쩌면 앞으로 nvs를 보게될 일이 없을지 모른다. 설치하느 고생했다.&lt;/p&gt;

&lt;h3 id=&quot;vs-code-설치&quot;&gt;VS Code 설치&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://code.visualstudio.com/&quot;&gt;VS Code&lt;/a&gt; 사이트에 접속하면 다운로드 가능한 버튼이 보인다. 클릭하여 설치한다.&lt;/p&gt;

&lt;h3 id=&quot;작업-공간-연성&quot;&gt;작업 공간 연성&lt;/h3&gt;

&lt;p&gt;프로그래밍을 시작하려면 어딘가에 코드를 타이핑해야한다. 여러가지 언어가 각각의 방식으로 이를 지원하는데 여기서는 극강 단순한 파일을 하나 다운받아서 시작해보겠다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/totuworld/slack-bot-class/archive/v0.0.zip&quot;&gt;스타트 패키지&lt;/a&gt;를 다운받아서 압축을 해제한다.&lt;/li&gt;
  &lt;li&gt;VS Code를 실행하고 압축 해제한 폴더를 불러온다.
    &lt;ul&gt;
      &lt;li&gt;VS Code 실행 후&lt;/li&gt;
      &lt;li&gt;파인더(Finder)에서 압축 해제한 폴더를 선택하여 끌어다놓으면(Drag &amp;amp; Drop) 된다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;고생했다. 이 지점까지 왔다면 50%는 성공한 것이다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;슬랙-봇-만들기&quot;&gt;슬랙 봇 만들기&lt;/h2&gt;

&lt;p&gt;여기서 만들고자하는 슬랙 봇을 설명해보겠다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;채널&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;에 누군가 들어오면(join)&lt;/li&gt;
  &lt;li&gt;봇이 정해진 메시지를 보낸다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;간단한 기능이다. 어떻게 만들 수 있을까? &lt;a href=&quot;https://slack.dev/node-slack-sdk/rtm-api#send-a-message&quot;&gt;슬랙 공식 문서&lt;/a&gt;에 잘 설명되어있다.&lt;/p&gt;

&lt;h3 id=&quot;안녕하고-인사하는-슬랙-봇-살펴보기&quot;&gt;안녕하고 인사하는 슬랙 봇 살펴보기&lt;/h3&gt;

&lt;p&gt;공식 문서를 보면 아래와 같은 코드가 나온다. 코드만 복붙하면 바로 작동가능한 수준이다.&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/totuworld/19591e2cd9fbdaffb55b7370e6611760.js?file=01-00-code.js&quot;&gt; &lt;/script&gt;

&lt;ul&gt;
  &lt;li&gt;3: &lt;em&gt;RTMClient&lt;/em&gt;를 사용하기 위해서 &lt;code&gt;@slack/rtm-api&lt;/code&gt; 패키지&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;에서 불러낸다.&lt;/li&gt;
  &lt;li&gt;4: 환경변수&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;를 활용해서 슬랙에서 사용하는 토큰&lt;sup id=&quot;fnref:5&quot;&gt;&lt;a href=&quot;#fn:5&quot; class=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;을 &lt;code&gt;token&lt;/code&gt; 이란 변수&lt;sup id=&quot;fnref:6&quot;&gt;&lt;a href=&quot;#fn:6&quot; class=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;에 할당한다.&lt;/li&gt;
  &lt;li&gt;5: new 연산자&lt;sup id=&quot;fnref:7&quot;&gt;&lt;a href=&quot;#fn:7&quot; class=&quot;footnote&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;로 앞서 불러낸 &lt;code&gt;RTMClient&lt;/code&gt; 인스턴스&lt;sup id=&quot;fnref:8&quot;&gt;&lt;a href=&quot;#fn:8&quot; class=&quot;footnote&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;를 생성하여 &lt;em&gt;rtm&lt;/em&gt; 변수에 할당한다.&lt;/li&gt;
  &lt;li&gt;9~21: &lt;code&gt;RTMClient&lt;/code&gt;가 수신할 수 있는 이벤트 중에 &lt;em&gt;member_joined_channel&lt;/em&gt;이 발생할 때 어떤 일을 할지 정의하는 블럭이다.&lt;/li&gt;
  &lt;li&gt;13: rtm의 sendMessage 메서드&lt;sup id=&quot;fnref:9&quot;&gt;&lt;a href=&quot;#fn:9&quot; class=&quot;footnote&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;를 활용해서 &lt;code&gt;Welcome to the channel,&lt;/code&gt; 메시지를 보낸다.&lt;/li&gt;
  &lt;li&gt;17: console.log 메서드로 실행 결과를 로그 메시지로 출력 한다. 이는 실제로 필요없지만 사람이 인지하기 위한 것이다.&lt;/li&gt;
  &lt;li&gt;23~25: rtm을 작동시킨다. 이 부분이 없으면 앞서 한 모든 작업이 작동하지 않는다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;typescript-코드로-변경하기&quot;&gt;TypeScript 코드로 변경하기&lt;/h3&gt;

&lt;p&gt;위 코드는 node.js에서 바로 실행할 수 있는 JavaScript 코드이다. 여기서는 TypeScript를 활용하므로 그에 맞게 코드로 변경해보자.&lt;/p&gt;

&lt;p&gt;아래 항목을 변경할 것이다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;require&lt;/code&gt;를 &lt;code&gt;import&lt;/code&gt;로 변경&lt;/li&gt;
  &lt;li&gt;console.log를 debug 패키지를 활용해서 변경&lt;/li&gt;
  &lt;li&gt;환경 변수명 변경&lt;/li&gt;
&lt;/ul&gt;

&lt;script src=&quot;https://gist.github.com/totuworld/19591e2cd9fbdaffb55b7370e6611760.js?file=01-01-code.ts&quot;&gt; &lt;/script&gt;

&lt;ul&gt;
  &lt;li&gt;1~8: node.js에서 패키지를 불러올 때 사용하는 require 대신 &lt;code&gt;import&lt;/code&gt;로 변경했다.&lt;/li&gt;
  &lt;li&gt;10: console.log를 대체할 수 있는 debug 패키지를 사용할 수 있도록 &lt;code&gt;log&lt;/code&gt; 변수에 할당.&lt;/li&gt;
  &lt;li&gt;12: 환경 변수명을 &lt;code&gt;SLACK_TOKEN&lt;/code&gt;으로 변경했고 기본값을 ‘token’으로 입력했다.&lt;/li&gt;
  &lt;li&gt;14: LogLevel을 추가했다.&lt;/li&gt;
  &lt;li&gt;25~26: TypeScript는 정적 언어처럼 타입을 정의할 수 있다. 하여 반환하는 값을 타입으로 변수뒤에 추가했다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;코드-실행해보기&quot;&gt;코드 실행해보기&lt;/h3&gt;

&lt;p&gt;작업 공간의 최상단에 &lt;code&gt;src&lt;/code&gt; 폴더를 만들어야한다. 후후 이것도 한번도 안해본거니까 그것부터 시작하자.&lt;/p&gt;

&lt;h4 id=&quot;src-폴더와-serverts-파일-만들기&quot;&gt;src 폴더와 server.ts 파일 만들기&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;VS Code의 좌측 메뉴 중 가장 위에 것(파일모양)인 Explorer가 클릭된 상태에서&lt;/li&gt;
  &lt;li&gt;폴더 아이콘을 클릭한 후 &lt;code&gt;src&lt;/code&gt;로 입력한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/slackbot/01/2019-04-24_11-02-05.png&quot; alt=&quot;src폴더생성&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;src 폴더를 선택한 상태에서 파일 아이콘을 클릭하여 &lt;code&gt;server.ts&lt;/code&gt;로 입력한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/slackbot/01/2019-04-24_11-02-27.png&quot; alt=&quot;server.ts생성&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;코드-붙여넣고-실행하기&quot;&gt;코드 붙여넣고 실행하기&lt;/h4&gt;

&lt;p&gt;코드를 붙여넣고 실행해보겠다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;VS code에서 &lt;code&gt;server.ts&lt;/code&gt; 파일을 선택하고 더블클릭 하면 파일이 에디터에 나타난다.&lt;/li&gt;
  &lt;li&gt;여기에 코드를 붙여넣자.&lt;/li&gt;
  &lt;li&gt;command + shift + &lt;code&gt;\&lt;/code&gt;` 키를 눌러서 VS code내의 터미널을 불러낸다.&lt;/li&gt;
  &lt;li&gt;아래 명령을 실행해서 작동시켜보자.&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;npm run start:dev
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;우리는 2가지를 하지 않았기 때문에 &lt;code&gt;실패&lt;/code&gt;한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;패키지 설치&lt;/li&gt;
  &lt;li&gt;SLACK_TOKEN 전달&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;패키지-설치&quot;&gt;패키지 설치&lt;/h4&gt;
&lt;p&gt;VS code에서 열어둔 터미널에 아래 명령을 입력해서 사용할 패키지를 모두 설치하자.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;npm install
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;p&gt;npm은 node의 &lt;code&gt;패키지 매니저&lt;/code&gt;다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;slack-토큰-발급받기&quot;&gt;slack 토큰 발급받기&lt;/h4&gt;

&lt;p&gt;슬랙에서 사용할 봇(Bot) 토큰을 얻으려면 슬랙의 워크스페이스가 필요하다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;이미 있다면 첫 단계는 넘어가도 된다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://slack.com/create&quot;&gt;슬랙 워크스페이스 생성&lt;/a&gt;에 진입하여 닫계별로 진행해서 슬랙 워크스페이스를 개설한다.&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;https://{워크스페이스}.slack.com/apps&lt;/code&gt; 앞 주소에 워크스페이스 부분을 자신의 워크스페이스로 바꾸고 bot을 검색하고 클릭한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/slackbot/01/2019-04-24_14-17-05.png&quot; alt=&quot;봇검색&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;Add Confiration&lt;/code&gt; 버튼을 클릭하여 단계별로 입력한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/slackbot/01/2019-04-24_11-57-53.png&quot; alt=&quot;컨피그레이션추가&quot; width=&quot;30%&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;생성된 봇 설정을 클릭하면 아래 화면처럼 토큰이 노출된다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/slackbot/01/2019-04-24_14-18-04.png&quot; alt=&quot;슬랙토큰&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;위 과정이 귀찮다면 &lt;code&gt;playwithcode.slack.com&lt;/code&gt; 에 가입하고 아래 토큰을 사용한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;xoxb-605331370387-618632598583-BDupfLyL6EjsmMbxsn1yTP19&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;결과-확인&quot;&gt;결과 확인&lt;/h4&gt;

&lt;p&gt;자 이제 모든 준비가 끝났다. 아래 명령에서 token만 자신의 토큰을 넣고 실행해보자.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;실행!!
    &lt;pre&gt;&lt;code&gt;SLACK_TOKEN={token} npm run start:dev
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
  &lt;li&gt;성공하면 봇이 slack 에 들어오게된다.&lt;/li&gt;
  &lt;li&gt;아래처럼 봇이 인사한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/slackbot/01/2019-04-24_14-20-26.png&quot; alt=&quot;tada&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;맺는-말&quot;&gt;맺는 말&lt;/h2&gt;
&lt;p&gt;별다른 배경 설명 다짜고짜 만들기 시작했는데 어땠는지 모르겠다.&lt;/p&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;터미널은 CLI(Command Line Interface) 즉, 글자로 컴퓨터와 이야기할 수 있는 프로그램이다. &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;슬랙 메신저에서 대화를 나누는 공간이 채널이다. &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;패키지는 누군가 만들어 둔 프로그래밍 묶음이다. node.js는 패키지를 활용해서 타인의 코드를 사용할 수 있다. &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;환경변수는 컴퓨터가 프로그램을 실행할 때 영향을 미치는 변경가능한 값의 모음이다. 쉽게 말해 작성한 &lt;code&gt;코드&lt;/code&gt; 안에 존재하지 않고 해당 코드를 실행할 때 외부에서 넣어주는 값이다. &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot;&gt;
      &lt;p&gt;토큰은 일종의 인증키이다. 슬랙은 토큰을 활용해서 토큰을 보유한 봇이나 사람이 다양한 API(Application Programming Interface)를 활용할 수 있도록 한다. &lt;a href=&quot;#fnref:5&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:6&quot;&gt;
      &lt;p&gt;변수란 수학에서 쓰는 변하는 값을 뜻한다. &lt;a href=&quot;#fnref:6&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:7&quot;&gt;
      &lt;p&gt;new 연산자는 사용자 정의 객체 타입 또는 내장 객체 타입의 인스턴스를 생성한다. 쉽게 말해 붕어빵 틀(Class)에 반죽과 앙꼬를 넣어 붕어빵(Instance)로 만들 때 사용한다. &lt;a href=&quot;#fnref:7&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:8&quot;&gt;
      &lt;p&gt;붕어빵 틀(Class)로 만든 붕어빵(Instance)을 생각하면 된다. &lt;a href=&quot;#fnref:8&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:9&quot;&gt;
      &lt;p&gt;클래스(Class) 안에 정의된 함수. &lt;a href=&quot;#fnref:9&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
            <pubDate>Wed, 24 Apr 2019 09:00:00 +0900</pubDate>
            <link />https://blog.totu.dev/2019/04/24/slackbot-01/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2019/04/24/slackbot-01/</guid>
            
            
            <category>nodejs</category>
            
        </item>
      
    
      
        <item>
            <title>30인 규모팀의 커피 주문하기 - 커피투게더</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#커피-주문의-문제&quot; id=&quot;markdown-toc-커피-주문의-문제&quot;&gt;커피 주문의 문제&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#문제-정리&quot; id=&quot;markdown-toc-문제-정리&quot;&gt;문제 정리&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#신기능-제작&quot; id=&quot;markdown-toc-신기능-제작&quot;&gt;신기능 제작!&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#1일-차---api-개발&quot; id=&quot;markdown-toc-1일-차---api-개발&quot;&gt;1일 차 - api 개발&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#2일-차---화면-개발&quot; id=&quot;markdown-toc-2일-차---화면-개발&quot;&gt;2일 차 - 화면 개발&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#운영-기록&quot; id=&quot;markdown-toc-운영-기록&quot;&gt;운영 기록&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#리팩토링&quot; id=&quot;markdown-toc-리팩토링&quot;&gt;리팩토링&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#마무리&quot; id=&quot;markdown-toc-마무리&quot;&gt;마무리&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#참고자료&quot; id=&quot;markdown-toc-참고자료&quot;&gt;참고자료&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;
&lt;p&gt;조직 생활을 하다보면 커피(차) 한 잔하며 휴식하는 일이 생긴다. 도란 도란 얘기도 나누고 새로온 사람과 인사도 나눌 수 있는 꼭 필요한 시간이다. 하지만 팀 규모가 10인을 넘으면 주문이 일이다. 야놀자의 범 CX실(CXPO, CXDEV)은 2019년 1/4분기에 30명이 넘어갔다. 와아~&lt;/p&gt;

&lt;h2 id=&quot;커피-주문의-문제&quot;&gt;커피 주문의 문제&lt;/h2&gt;
&lt;p&gt;커피 주문은 간단하다. 원하는 주문을 말하고 계산하면 된다.  하지만 사람이 많아지면 주문을 모으는 일이 힘들다. 아래 예시를 보자.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/coffeeorder/coffee_order_01.jpg&quot; alt=&quot;주문예시&quot; width=&quot;40%&quot; /&gt;&lt;/p&gt;

&lt;p&gt;CX실의 규칙은 다음과 같다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;자신이 주문할 메뉴가 있는지 쓰레드를 살핀다.&lt;/li&gt;
  &lt;li&gt;주문이 없다면 신규 메뉴를 쓰레드에 남긴다.&lt;/li&gt;
  &lt;li&gt;혼자만 주문했어도 반드시 ✋ 이모지를 남겨서 카운트하기 쉽도록 한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;위 예시에서 &lt;code&gt;아이스 아메리카노&lt;/code&gt; 를 살펴보자. 샷을 추가하가한 메뉴와 &lt;code&gt;아이스아메&lt;/code&gt; 라고 따로 등록한 것까지 비슷한 주문이 흩어져있다. 또 아이스아메는 ✋이모지가 없다. 신규 입사자가 늘어나면서 규칙 전파가 잘 안된다고 볼 수 있다.&lt;/p&gt;

&lt;p&gt;주문 몇 잔인지 체크하기도 어렵다. 또 실제 주문 중인데 주문이 바뀌는 일도 가능하다. 주문에 성공해도 어떤게 내 주문인지 확인하기 어려웠다.&lt;/p&gt;

&lt;h3 id=&quot;문제-정리&quot;&gt;문제 정리&lt;/h3&gt;

&lt;p&gt;위 문제를 해결하는 방법을 정리해보자.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;같은 주문을 누적해서 표시&lt;/li&gt;
  &lt;li&gt;총 몇 잔인지 합계 표시&lt;/li&gt;
  &lt;li&gt;특정 시점에서 주문을 종료하여 변경 불가능하도록 설정&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;신기능-제작&quot;&gt;신기능 제작!&lt;/h2&gt;

&lt;p&gt;CX실에는 &lt;a href=&quot;https://yanolja.github.io/2018/09/Work-Log&quot;&gt;워크로그 개발기&lt;/a&gt;가 기 개발된 상태였다. 곧 CX실 인원이 커피 주문을 하는 서비스라면 &lt;code&gt;워크로그&lt;/code&gt;에 새로운 기능을 추가하면 될 터!&lt;/p&gt;

&lt;h3 id=&quot;1일-차---api-개발&quot;&gt;1일 차 - api 개발&lt;/h3&gt;

&lt;p&gt;커피(차) 한 잔 하는 하는 휴식을 &lt;code&gt;이벤트&lt;/code&gt;로 생각했다. 이벤트에 주최자와 참석자를 특정할 수 있다. 그리고 이벤트는 &lt;code&gt;주문&lt;/code&gt;을 가질 수 있다. 주문은 &lt;code&gt;음료&lt;/code&gt; id를 특정하는데 이때 주문자의 - 휘핑 없이같은 - 옵션을 추가할 수 있다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/coffeeorder/coffee_order_db.png&quot; alt=&quot;주문db&quot; /&gt;&lt;/p&gt;

&lt;p&gt;개략적인 구조는 저렇다. 이를 바탕으로 &lt;code&gt;이벤트&lt;/code&gt;, &lt;code&gt;주문&lt;/code&gt;, &lt;code&gt;참가자&lt;/code&gt;, &lt;code&gt;음료&lt;/code&gt;에 관한 &lt;a href=&quot;https://en.wikipedia.org/wiki/Create,_read,_update_and_delete&quot;&gt;CRUD&lt;/a&gt; api를 제작했다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;GET /events 이벤트 목록&lt;/li&gt;
  &lt;li&gt;POST /events 이벤트 등록&lt;/li&gt;
  &lt;li&gt;GET /events/:event_id 이벤트 정보&lt;/li&gt;
  &lt;li&gt;PUT /events/:event_id 이벤트 수정&lt;/li&gt;
  &lt;li&gt;GET /events/:event_id/guests 참가자 목록&lt;/li&gt;
  &lt;li&gt;POST /events/:event_id/guests 참가자 등록&lt;/li&gt;
  &lt;li&gt;GET /events/:event_id/orders 주문 목록&lt;/li&gt;
  &lt;li&gt;POST /events/:event_id/orders 주문 추가 및 갱신&lt;/li&gt;
  &lt;li&gt;DELETE /events/:event_id/orders/:guest_id 주문 삭제&lt;/li&gt;
  &lt;li&gt;GET /beverages 음료 목록&lt;/li&gt;
  &lt;li&gt;POST /beverages 음료 등록&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;추가로 사내 메신저인 &lt;a href=&quot;https://slack.com/&quot;&gt;슬랙&lt;/a&gt; 데이터를 워크로그 DB에 등록한 상태이므로 &lt;code&gt;참가자&lt;/code&gt; 에게 메시지 발송하는 기능도 추가했다.&lt;/p&gt;

&lt;h3 id=&quot;2일-차---화면-개발&quot;&gt;2일 차 - 화면 개발&lt;/h3&gt;
&lt;p&gt;개발한 화면은 총 3개다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;전체 &lt;code&gt;이벤트&lt;/code&gt; 목록 출력 페이지&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;이벤트&lt;/code&gt; 등록 페이지&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;이벤트&lt;/code&gt; 상세 페이지&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;재사용가능한 컴포넌트가 별로 없어서 새로 만들었지만 구현이 간단한 편이라서 생각보다 빨리 완료했다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;워크로그는 razzle + after.js + react.js + mobx 기반&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/coffeeorder/quickquick.png&quot; alt=&quot;뚝딱맨&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;운영-기록&quot;&gt;운영 기록&lt;/h2&gt;

&lt;p&gt;2일 간의 가열찬 개발 후 대망의 서비스 오픈!!&lt;/p&gt;

&lt;figure class=&quot;large&quot;&gt;
  &lt;div class=&quot;myvideo&quot;&gt;
     &lt;video style=&quot;width:50%&quot; controls=&quot;&quot; loop=&quot;loop&quot;&gt;
         &lt;source src=&quot;/images/coffeeorder/i_love_coffee.mp4&quot; type=&quot;video/mp4&quot; /&gt;
     &lt;/video&gt;
  &lt;/div&gt;
&lt;figcaption&gt;커피 주문 동작예시&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;CX실 채널에서 크게 환영받았다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/coffeeorder/coffee_order_launch.png&quot; alt=&quot;서비스오픈&quot; /&gt;&lt;/p&gt;

&lt;p&gt;손쉽게 끝날줄 알았지만 데이터베이스(Database)가 터진다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/coffeeorder/coffee_order_error.jpg&quot; alt=&quot;서비스에러&quot; width=&quot;80%&quot; /&gt;&lt;/p&gt;

&lt;p&gt;돈으로 막을 수 있는건 돈으로 막는게 최고! Firebase를 유료 모델로 올려서 첫날 서비스를 마쳤다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;최소 기능만 가지고 서비스를 강행 오픈했을 때 참사를 경험&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;리팩토링&quot;&gt;리팩토링&lt;/h3&gt;

&lt;p&gt;가만 보니 사용자 전체 목록 조회 부분과 이벤트 내 주문, 음료 목록 전체 로딩을 매번 새롭게 하고 있었다. 변경(Create, Update, Delete)발생할 때만 새롭게 데이터를 읽어서 서버 인메모리에 저장한다. 평소의 읽기는 인메모리 캐시를 먼저 확인하고 비었으면 데이터베이스로부터 데이터를 읽도록 했다.&lt;/p&gt;

&lt;h2 id=&quot;마무리&quot;&gt;마무리&lt;/h2&gt;

&lt;p&gt;이 후 자잘한 업데이트 중이다. 죽었던 다른 기능을 살리고, 불편 사항을 접수해서 개선하기도 한다. &lt;code&gt;토이 프로젝트&lt;/code&gt;는 재미있다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;참고자료&quot;&gt;참고자료&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/totuworld/time-recorder-viewer&quot;&gt;워크로그 레포지토리&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
            <pubDate>Wed, 17 Apr 2019 09:00:00 +0900</pubDate>
            <link />https://blog.totu.dev/2019/04/17/coffeetogether/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2019/04/17/coffeetogether/</guid>
            
            
            <category>etc</category>
            
        </item>
      
    
      
        <item>
            <title>아빠 왜 집에서 일해요? (feat. aws)</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#어플리케이션의-미동작-확인&quot; id=&quot;markdown-toc-어플리케이션의-미동작-확인&quot;&gt;어플리케이션의 미동작 확인&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#어디가-문제야&quot; id=&quot;markdown-toc-어디가-문제야&quot;&gt;어디가 문제야?&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#복구-작업&quot; id=&quot;markdown-toc-복구-작업&quot;&gt;복구 작업&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#그렇다면-내가-직접-설치해주지&quot; id=&quot;markdown-toc-그렇다면-내가-직접-설치해주지&quot;&gt;그렇다면 내가 직접 설치해주지!&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#마무리&quot; id=&quot;markdown-toc-마무리&quot;&gt;마무리&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;

&lt;p&gt;AWS의 PaaS(Platform as a Service)인 Elastic Beanstalk(이하 Beanstalk)로 node.js 어플리케이션을 배포/운영하고 있다. 로컬이나 dev 환경에서 작동을 확인한 배포판이 production 환경으로 배포만 하면 npm install 시 문제를 발생시킨다?!. 이때 어떻게 대처했는지 기록을 남긴다.&lt;/p&gt;

&lt;h2 id=&quot;어플리케이션의-미동작-확인&quot;&gt;어플리케이션의 미동작 확인&lt;/h2&gt;
&lt;p&gt;크론잡(cronjob)처럼 일정 주기로 정해진 일을 처리하는 어플리케이션이 있다. 해당 어플리케이션은 각각의 테스크를 수행하고 슬랙의 특정 채널에 결과를 남긴다. 그런데 production 환경의 메시지가 사라졌다.&lt;/p&gt;

&lt;h3 id=&quot;어디가-문제야&quot;&gt;어디가 문제야?&lt;/h3&gt;
&lt;p&gt;Beanstalk 환경에 접속해서 node.js 로그를 확인해봤다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;## nodejs 로그를 확인
$ tail /var/log/nodejs/nodejs.log
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;production 배포판이 특정 패키지를 찾을 수 없어서 시작단계에서 실패하고 있었다. 최근 로그 100줄을 다운받아 확인해보니 npm install 시 특정 패키지를 설치하는데 실패한 기록이 있었다. 개발 환경을 배포한 배포판과 같은 commit으로 돌리고 패키지 설치를 진행해보니 실제로 패키지가 없었다. 어떤 과정에서 누가 패키지를 삭제했는지 모르겠지만 일단 production 환경을 살리자!&lt;/p&gt;

&lt;h2 id=&quot;복구-작업&quot;&gt;복구 작업&lt;/h2&gt;
&lt;p&gt;우선 문제가 된 패키지의 상위 버전이 있는지 확인해서 설치했다. 그리고 npm audit 에서 문제로 지적된 몇몇 패지키지도 업데이트했다. 그리고 배포판을 만들어서 dev 환경으로 뿌렸더니 잘 된다. 그런데 production으로 배포해보니 실패를 거듭했다. 역시 패키지 설치단계에서 에러를 반환하고 특정 패키지가 없다는 에러를 내고 있었다.&lt;/p&gt;

&lt;h3 id=&quot;그렇다면-내가-직접-설치해주지&quot;&gt;그렇다면 내가 직접 설치해주지!&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;eb cli&lt;/code&gt;로 Beanstalk 환경에 접속한 뒤 아래처럼 실행했다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;## sudo 권한 획득
$ sudo su

## 설치된 nodejs 버전 보기. 10.13 버전이 있는지 확인하는 용도
$ ls /opt/elasticbeanstalk/node-install

## path 설정
$ export PATH=$PATH:/opt/elasticbeanstalk/node-install/node-v10.13.0-linux-x64/bin/

## 소스코드 있는 곳
$ cd /var/app/current

## package 설치!
$ npm install
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;직접 패키지를 설치했더니 문제없이 잘 설치되었다. 이제 남은건 node 프로세스를 재시작하는 것!&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;## node 프로세스 kill (sudo 권한 필요)
$ pkill -f node

## 프로세스 list 확인
$ initctl list

## nodejs 서비스 시작
$ initctl start nodejs
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;이제 Beanstalk의 health check을 지켜보거나 node.js 로그를 확인해보자.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;## nodejs 로그를 확인
$ tail /var/log/nodejs/nodejs.log
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;마무리&quot;&gt;마무리&lt;/h2&gt;
&lt;p&gt;출근해서 왜 문제가 되었나 살펴봤더니 dev와 production 환경의 node.js 플랫폼 버전이 달랐다. 버전을 맞추니 모든 문제가 사라졌다. 역시 기본이 제일 중요하다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;아빠가 집에와서 일하느라 놀아주지 못해서 미안해~ 😭&lt;/p&gt;
&lt;/blockquote&gt;
</description>
            <pubDate>Wed, 09 Jan 2019 09:00:00 +0900</pubDate>
            <link />https://blog.totu.dev/2019/01/09/aws-beanstalk/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2019/01/09/aws-beanstalk/</guid>
            
            
            <category>aws</category>
            
        </item>
      
    
      
        <item>
            <title>3분 게임 서버(Firebase) 진행사항 1</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2018년은-뭘&quot; id=&quot;markdown-toc-2018년은-뭘&quot;&gt;2018년은 뭘?&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#진행-사항&quot; id=&quot;markdown-toc-진행-사항&quot;&gt;진행 사항&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#다음-주제&quot; id=&quot;markdown-toc-다음-주제&quot;&gt;다음 주제&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#맺음말&quot; id=&quot;markdown-toc-맺음말&quot;&gt;맺음말&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;

&lt;p&gt;2018년 1/4분기는 어떻게 지났는지 모르겠다. 그냥 정신차리고보니 3월 30일이다.&lt;/p&gt;

&lt;h2 id=&quot;2018년은-뭘&quot;&gt;2018년은 뭘?&lt;/h2&gt;
&lt;p&gt;2017년 3월에 &lt;a href=&quot;https://github.com/totuworld/Wendy&quot;&gt;Wendy 프로젝트&lt;/a&gt; 첫번째 파트를 종료했다. &lt;del&gt;그리고 해당 프로젝트는 장렬하게 산화했다.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;그후 여러가지 핑계로 2017년은 별 활동없이 지나갔다. 2018년은 무엇을할지 고민하다 순순이의 추천과 때마침 시작된 Firebase 스터디 덕분에 Firebase로 방향을 잡았다.&lt;/p&gt;

&lt;p&gt;Unity 3D로 게임 클라이언트를 제작하는 클라이언트 프로그래머가 간단히 사용할 수 있는 게임 서버 제작을 연재해볼까 한다.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;일은 내가 안해요. Google이 해요.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;진행-사항&quot;&gt;진행 사항&lt;/h3&gt;
&lt;p&gt;Firebase 스터디에서 첫 주제로 인증(Auth)을 다뤄서 아래 2개의 글을 작성했다.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.totu.dev/2018/03/22/firebaseandunity-01/&quot;&gt;3분 게임 서버(Firebase) - Auth 익명 로그인&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.totu.dev/2018/03/22/firebaseandunity-02/&quot;&gt;3분 게임 서버(Firebase) - Auth 소셜 로그인&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;다음-주제&quot;&gt;다음 주제&lt;/h3&gt;
&lt;p&gt;다음 주제는 데이터베이스(Realtime Database)이다. Unity로 로또를 할 수 있게 클라이언트를 만들고 데이터 관리를 다루려고 한다. 게임 만드는 과정은 통째로 넘어가버릴 것이고 - 클라이언트 안한지 오래되어 수준이 아주 낮아 - 데이터베이스만 다루려고 한다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/lotto_proto_01.gif&quot; alt=&quot;프로토타입수준실화냐&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;이거 만든다고 5시간 썼다면 믿으시겠습니까!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;맺음말&quot;&gt;맺음말&lt;/h2&gt;
&lt;p&gt;미래의 토투가 해야할 일이 밀린 회사와 6월말 출산을 앞둔 2/4분기. 과연 얼마나 글을 진행할 수 있을까. 미래의 토투 힘내라.&lt;/p&gt;
</description>
            <pubDate>Fri, 30 Mar 2018 09:00:00 +0900</pubDate>
            <link />https://blog.totu.dev/2018/03/30/report/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2018/03/30/report/</guid>
            
            
            <category>firebase</category>
            
        </item>
      
    
      
        <item>
            <title>3분 게임 서버(Firebase) - Auth 소셜 로그인</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#준비-과정&quot; id=&quot;markdown-toc-준비-과정&quot;&gt;준비 과정&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#facebook-로그인&quot; id=&quot;markdown-toc-facebook-로그인&quot;&gt;Facebook 로그인&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#프로그래밍-준비&quot; id=&quot;markdown-toc-프로그래밍-준비&quot;&gt;프로그래밍 준비&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#facebook-로그인-구현&quot; id=&quot;markdown-toc-facebook-로그인-구현&quot;&gt;Facebook 로그인 구현&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#디버깅&quot; id=&quot;markdown-toc-디버깅&quot;&gt;디버깅&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#마무리&quot; id=&quot;markdown-toc-마무리&quot;&gt;마무리&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#참고자료&quot; id=&quot;markdown-toc-참고자료&quot;&gt;참고자료&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;

&lt;p&gt;지난 시간에 다룬 &lt;a href=&quot;https://blog.totu.dev/2018/03/22/firebaseandunity-01/&quot;&gt;익명 로그인&lt;/a&gt;은 기본이다. 익명 로그인은 Apple의 앱스토어 검수 조건에도 해당한다.&lt;/p&gt;

&lt;p&gt;사용자가 선택할 수 있는 그 다음 선택지는 소셜 로그인이다. 비밀번호와 같은 자산이 Facebook이나 Google 등 대형 회사가 관리되니 안심되고 설령 게임을 지워도 다시 데이터를 복원을 기준을 제공해주기 때문이다.&lt;/p&gt;

&lt;p&gt;Firebase 인증은 Google, Play 게임(구글 플레이), Facebook, Twitter, Github 등의 로그인이 가능하다. 그 중 여기서는 페이스북 로그인을 다뤄보겠다.&lt;/p&gt;

&lt;h2 id=&quot;준비-과정&quot;&gt;준비 과정&lt;/h2&gt;
&lt;p&gt;Firebase 인증의 &lt;code&gt;로그인 방법&lt;/code&gt;에 Facebook을 등록해야한다. 그러기위해서는 Facebook에 앱을 생성해야한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://developers.facebook.com/apps/&quot;&gt;facebook for developers의 앱 대시보드&lt;/a&gt;에 접속 한 뒤 &lt;code&gt;새 앱 추가&lt;/code&gt; 버튼을 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_01.png&quot; alt=&quot;새 앱 추가&quot; width=&quot;10%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;표시할 이름과 연락처 이메일을 등록한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_02.png&quot; alt=&quot;새 앱 ID만들기 입력&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;페이스북 앱의 대시보드 중 &lt;code&gt;Facebook 로그인&lt;/code&gt;의 &lt;code&gt;설정&lt;/code&gt; 버튼을 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_03.png&quot; alt=&quot;Facebook 로그인 설정&quot; width=&quot;30%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;이제 &lt;code&gt;빠른 시작&lt;/code&gt; 절차가 시작된다. 이를 무시하고 좌측 메뉴에서 &lt;code&gt;설정&lt;/code&gt; - &lt;code&gt;기본 설정&lt;/code&gt;을 클릭하여 &lt;code&gt;앱 ID&lt;/code&gt;와 &lt;code&gt;앱 시크릿 코드&lt;/code&gt;를 확인한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_05.png&quot; alt=&quot;설정 - 기본 설정&quot; width=&quot;30%&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_06.png&quot; alt=&quot;앱 ID와 앱 시크릿 코드 확인&quot; width=&quot;30%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;하단의 &lt;code&gt;+ 플랫폼 추가&lt;/code&gt; 버튼을 클릭하고 iOS나 Android 등의 플랫폼을 선택한다(여기서는 iOS를 기준으로 설명한다). &lt;code&gt;번들 ID&lt;/code&gt;를 입력한다. 다 입력하면 하단의 &lt;code&gt;변경 내용 저장&lt;/code&gt;을 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_07.png&quot; alt=&quot;iOS 번들 ID 입력&quot; width=&quot;80%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;이제 아대시보드로 접속하여 &lt;code&gt;로그인 방법&lt;/code&gt;탭을 선택한 뒤 &lt;code&gt;Facebook&lt;/code&gt;을 클릭한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;사용 설정&lt;/code&gt;을 클릭하고 앞서 확인한 &lt;code&gt;앱 ID&lt;/code&gt;와 &lt;code&gt;앱 시크릿 코드&lt;/code&gt;를 입력한다. &lt;code&gt;OAuth 리디렉션 URI&lt;/code&gt;를 복사한다(복사 아이콘 클릭)하고 &lt;code&gt;저장&lt;/code&gt; 버튼을 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_08.png&quot; alt=&quot;앱 ID, 앱 시크릿 코드 입력&quot; width=&quot;60%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;facebook for developers 대시보드로 돌아가서 복사한 &lt;code&gt;OAuth 리디렉션 URI&lt;/code&gt;를 &lt;code&gt;Facebook 로그인&lt;/code&gt; - &lt;code&gt;설정&lt;/code&gt;에서 &lt;code&gt;유효한 OAuth 리디렉션 URI&lt;/code&gt;에 붙여넣고 &lt;code&gt;변경 내용 저장&lt;/code&gt;을 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_09.png&quot; alt=&quot;좌측 메뉴의 Facebook 로그인 - 설정&quot; width=&quot;30%&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_01_10.png&quot; alt=&quot;유효한 OAuth 리디렉션 URI 입력&quot; width=&quot;40%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;facebook-로그인&quot;&gt;Facebook 로그인&lt;/h2&gt;

&lt;p&gt;Facebook 로그인도 익명 로그인과 비슷한 절차로 진행된다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;사용자) Facebook 로그인 버튼 클릭&lt;/li&gt;
  &lt;li&gt;게임 클라이언트) Facebook SDK를 활용해서 로그인 화면 표시&lt;/li&gt;
  &lt;li&gt;사용자) 로그인 진행&lt;/li&gt;
  &lt;li&gt;Facebook) access token 반환&lt;/li&gt;
  &lt;li&gt;게임 클라이언트) access token을 Firebase 인증 SDK를 통해 등록&lt;/li&gt;
  &lt;li&gt;Firebase) 사용자 등록 과정 진행&lt;/li&gt;
  &lt;li&gt;게임 클라이언트) 고유한 사용자 ID를 사용&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;프로그래밍-준비&quot;&gt;프로그래밍 준비&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://blog.totu.dev/2018/03/22/firebaseandunity-01/&quot;&gt;익명 로그인&lt;/a&gt;을 진행했다면 그 프로젝트를 이어서 사용해도 무방하다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;아래 프로젝트 파일을 다운받는다.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;https://github.com/totuworld/firebase_toturial/archive/auth_guest.zip&quot;&gt;샘플 프로젝트&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://developers.facebook.com/docs/unity&quot;&gt;Facebook SDK for Unity&lt;/a&gt;로 접속해서 Facebook Unity SDK를 다운로드한다(작성일 기준 v7.11.1).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Unity 2017.3를 실행한 뒤 샘플 프로젝트를 열고 &lt;a href=&quot;https://blog.totu.dev/2018/03/22/firebaseandunity-01/#프로젝트-설정&quot;&gt;익명 로그인&lt;/a&gt;의 &lt;code&gt;프로젝트 설정&lt;/code&gt; 부분을 참고하여 &lt;code&gt;GoogleService-Info.plist&lt;/code&gt; 파일을 생성하여 샘플 프로젝트에 추가한다. 다운로드한 Facebook Unity SDK도 추가한다.&lt;/p&gt;

    &lt;p&gt;Facebook Unity SDK를 추가하면 Firebase Auth SDK와 충돌하는 파일이 4개 있다. 프로젝트에 사용된 Firebase Unity SDK는 4.3이고 Facebook Unity SDK는 7.11.1이다. 충돌이나는 파일은 &lt;code&gt;PlayServicesResolver의&lt;/code&gt; 폴더에 있는 4개 파일인데 1.2.59 버전 파일을 모두 삭제한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_02_01.png&quot; alt=&quot;PlayServicesResolver 내 파일 삭제&quot; width=&quot;80%&quot; /&gt;&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;Android 빌드는 확인해보지 않아서 어떤 문제가 발생할지 모릅니다.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Unity에서 &lt;code&gt;Facebook&lt;/code&gt; - &lt;code&gt;Edit Settings&lt;/code&gt; 메뉴 선택한 뒤 facebook for developers에서 확인한 &lt;code&gt;앱 ID&lt;/code&gt;를 입력한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_02_02.png&quot; alt=&quot;Facebook - Edit Settings 메뉴 선택&quot; width=&quot;20%&quot; /&gt;
  &lt;img src=&quot;/images/fb_03_02_03.png&quot; alt=&quot;Facebook 앱 ID 입력&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;facebook-로그인-구현&quot;&gt;Facebook 로그인 구현&lt;/h3&gt;

&lt;p&gt;Facebook 로그인은 2 단계로 진행된다. Facebook Unity SDK로 로그인을 진행하고, Facebook에서 반환한 access token으로 Firebase Auth SDK로 등록을 진행한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;gfb_auth_test.cs&lt;/code&gt; 스크립트를 열고 아래처럼 변경한다.
    &lt;ul&gt;
      &lt;li&gt;8번 줄: using으로 필요한 네임스페이스 형식 사용 허용(Facebook.Unity)&lt;/li&gt;
      &lt;li&gt;29~32번 줄(&lt;code&gt;Start&lt;/code&gt; 메서드 내): Facebook SDK를 초기화 추가&lt;/li&gt;
      &lt;li&gt;40~45번 줄: Firebase 인증 SDK로 signin이 된 상태인지 확인하는 프로퍼티 추가&lt;/li&gt;
      &lt;li&gt;90~184번 줄(페이스북 로그인 관련 메서드 region): 페이스북 로그인을 시도하고 firebase에 등록하는 메서드가 모여있다. 아래 흐름도를 살펴보고 코드를 보면 조금 더 이해하기 수월하다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/fb_03_03_01.png&quot; alt=&quot;페이스북 흐름도&quot; /&gt;&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com//785a451847aebd36a548061a47cf261a.js?file=gfb_auth_test_for_fb.cs&quot;&gt; &lt;/script&gt;

&lt;ul&gt;
  &lt;li&gt;gfb_auth_test의 &lt;code&gt;facebookLogin&lt;/code&gt; 메서드가 실행되어야 페이스북 로그인을 시도할 수 있다.
    &lt;ul&gt;
      &lt;li&gt;Canvas - Button 게임 오브젝트의 Button 컴포넌트를 찾아서 복사한 뒤 적당히 위치 시키고 &lt;code&gt;Facebook Login&lt;/code&gt;으로 텍스트를 변&lt;/li&gt;
      &lt;li&gt;gfb_auth_test 스크립트의 &lt;code&gt;facebookLogin&lt;/code&gt;을 선택한다.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_03_03_02.png&quot; alt=&quot;버큰 복사 후 텍스트 변경&quot; width=&quot;30%&quot; /&gt;
  &lt;img src=&quot;/images/fb_03_03_03.png&quot; alt=&quot;버튼 연결&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;디버깅&quot;&gt;디버깅&lt;/h3&gt;

&lt;p&gt;Firebase 인증 SDK로 Facebook 로그인을 시도하면 Unity Editor에서는 디버깅이 불가능하다. 빌드 후 앱 클라이언트에서 확인해야한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;iOS의 빌드의 경우 Facebook SDK 추가 후 빌드 시 Build Settting에서 Enable Bitcode를 No로 설정해야 linker 에러 없이 진행된다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/fb_03_04_01.png&quot; alt=&quot;등록 확인&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Facebook 로그인 후 Firebase에 등록을 마치면 위 그림처럼 나타난다.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/totuworld/firebase_toturial/archive/auth_facebook.zip&quot;&gt;완료된소스코드&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;마무리&quot;&gt;마무리&lt;/h2&gt;

&lt;p&gt;간단히 끝날 내용이었는데 linker 에러와 Firebase 내의 Facebook 앱 ID를 잘못 입력해서 많은 빌드 실패가 있었다. 꼭 설정은 2번 3번 확인하길 바란다.&lt;/p&gt;

&lt;p&gt;그리고 이런 다양한 문제를 해결하고 있는 클라이언트 프로그래머 여러분 대단하십니다👍👍👍.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;참고자료&quot;&gt;참고자료&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://firebase.google.com/docs/auth/unity/facebook-login&quot;&gt;Authenticate Using Facebook Login and Unity&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://firebase.google.com/docs/auth/unity/account-linking&quot;&gt;Link Multiple Auth Providers to an Account in Unity&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developers.facebook.com/docs/unity/examples#login&quot;&gt;Facebook SDK for Unity - Examples&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/facebook/facebook-sdk-for-unity/issues/135&quot;&gt;Facebook SDK for Unity isssue 135&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
            <pubDate>Thu, 22 Mar 2018 09:00:00 +0900</pubDate>
            <link />https://blog.totu.dev/2018/03/22/firebaseandunity-02/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2018/03/22/firebaseandunity-02/</guid>
            
            
            <category>nodejs</category>
            
            <category>firebase</category>
            
            <category>unity</category>
            
        </item>
      
    
      
        <item>
            <title>3분 게임 서버(Firebase) - Auth 익명 로그인</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#고백&quot; id=&quot;markdown-toc-고백&quot;&gt;고백&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#firebase의-약팔이-새로운-기능&quot; id=&quot;markdown-toc-firebase의-약팔이-새로운-기능&quot;&gt;Firebase의 &lt;del&gt;약팔이&lt;/del&gt; 새로운 기능&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#사용자-로그인-흐름&quot; id=&quot;markdown-toc-사용자-로그인-흐름&quot;&gt;사용자 로그인 흐름&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#준비-과정&quot; id=&quot;markdown-toc-준비-과정&quot;&gt;준비 과정&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#프로젝트-추가&quot; id=&quot;markdown-toc-프로젝트-추가&quot;&gt;프로젝트 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#프로젝트-설정&quot; id=&quot;markdown-toc-프로젝트-설정&quot;&gt;프로젝트 설정&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#익명-로그인&quot; id=&quot;markdown-toc-익명-로그인&quot;&gt;익명 로그인&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#프로그래밍-준비&quot; id=&quot;markdown-toc-프로그래밍-준비&quot;&gt;프로그래밍 준비&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#익명-로그인-구현&quot; id=&quot;markdown-toc-익명-로그인-구현&quot;&gt;익명 로그인 구현&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#디버깅&quot; id=&quot;markdown-toc-디버깅&quot;&gt;디버깅&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#마무리&quot; id=&quot;markdown-toc-마무리&quot;&gt;마무리&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;

&lt;h3 id=&quot;고백&quot;&gt;고백&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.totu.dev/2016/12/21/azureandunity-01/&quot;&gt;이세계에 진입한 서버 개발&lt;/a&gt;을 시작하고 1년이 지났다. 그 동안 이직을 했고 바쁜 시간을 보냈다는 핑계로 업데이트 없는 9개월을 보냈다.&lt;/p&gt;

&lt;p&gt;놀기만 했으면 좋으련만 6월부터 &lt;code&gt;이세계에 진입한 서버 개발&lt;/code&gt;을 책으로 출판할 생각으로 작업중이었는데 최근 절필했다. 2가지 이유가 있다. 하나는 오래된 코드라서 봐줄 수 없었다(이건 내 실력이…). 다른 하나는 게임 클라이언트 프로그래머만 있는 소규모 게임 개발팀에서 node.js와 관계형 데이터베이스를 공부해서 게임용 웹 서버를 만들 수 있을까하는 의문이다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;게임 개발할 시간도 없는데 서버는 젠장!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Wendy를 활용하는 게임 클라이언트 프로그래머가 인프라 공부에 시간 보낼까봐 PaaS(Platform as a Service)를 사용하도록 유도했지만 충분한 대답이 아니었다. 이보다 더 낮은 진입이 가능해야 순수 클라이언트 프로그래머가 공부할 수 있을 듯 했다. 그렇다면 좋은 서비스는 Parse나 Firebase같은 BaaS(Backend as a Service)다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Facebook이 인수하여 서비스하던 Parse는 서비스가 종료되었다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;firebase의-약팔이-새로운-기능&quot;&gt;Firebase의 &lt;del&gt;약팔이&lt;/del&gt; 새로운 기능&lt;/h3&gt;

&lt;p&gt;과거의 Firebase는 모바일 게임용 백엔드로 활용하기에 문제가 있었다. 게임 클라이언트에 Firebase SDK를 활용해 비지니스 로직을 넣게된다. 운영중에 비지니스 로직에 문제가 발생하면 모바일 게임은 플랫폼 심사 시간이 있어 빠른 대처가 어렵다. 출시 후 운영중에 대처가 늦으면 사용자 감소와 함께 매출이 감소한다. 이런 부담은 QA로 해소될 수 있으나 소규모 게임 제작팀은 비용때문에 불가능하다.&lt;/p&gt;

&lt;p&gt;2017년 3월 Firebase에 node.js 환경으로 프로그래밍이 가능한 &lt;code&gt;Cloud Functions&lt;/code&gt;이 추가되었다. 이 기능을 활용하면 비지니스 로직을 게임 클라이언트 외부로 옮길 수 있다. 또 Firebase에 &lt;code&gt;Realtime Database&lt;/code&gt;외에도 &lt;code&gt;Cloud Firestore&lt;/code&gt;란 데이터베이스가 추가되었다. 이제 거대한 파일 하나에 모든 데이터를 넣지 않아도 된다. 단, 아직까지 Firebase Unity SDK에서는 사용할 수 없다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;MS에서도 &lt;a href=&quot;http://Playfab.com&quot;&gt;Playfab&lt;/a&gt;을 인수하여 Google의 Firebase같은 서비스를 제공할 예정이다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;새롭게 연재하는 글에서는 Firebase를 이용해서 게임 서버를 사용하도록 권장한다. 특히 클라이언트 프로그래머가 보유한 팀이라면 더더욱 이 방법을 추천한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;처음부터 c++로 서버 프로그래밍하는 책 사지 마시라. 어느정도 필요가 차올랐을 때 아주 간단한 것부터 시작하길 권한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;사용자-로그인-흐름&quot;&gt;사용자 로그인 흐름&lt;/h2&gt;
&lt;p&gt;서론이 길었다. 이번에 진행할 것은 익명 로그인이다. 먼저 사용자가 게임을 시작했을 때 어떤 단계를 걸치는지 상상해보자.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;타이틀 화면
    &lt;ul&gt;
      &lt;li&gt;게스트/페북 로그인 클릭(1회면 진행됨)&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_02_01_01n.png&quot; alt=&quot;타이틀 화면&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;로그인 절차&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_02_01_02n.png&quot; alt=&quot;로그인&quot; width=&quot;30%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;게임 플레이&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_02_01_03n.png&quot; alt=&quot;게임 플레이&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;이 과정을 거치는 이유는 제작자 혹은 운영자가 통제하는 시스템에 등록된 사용자인지 확인하기 위해서이다. 그럼 가장 간편한 로그인 방식인 익명 로그인 - 혹은 게스트 로그인 - 을 Firebase 인증(Authentication)을 활용해서 제작해보자.&lt;/p&gt;

&lt;p&gt;가장 간편한 로그인 방식인 익명 로그인을 알아보자.&lt;/p&gt;

&lt;h2 id=&quot;준비-과정&quot;&gt;준비 과정&lt;/h2&gt;
&lt;p&gt;Unity 클라이언트에서 Firebase 인증을 활용해서 익명 로그인을 구현하려면 몇가지 선행 과정이 필요하다.&lt;/p&gt;

&lt;h3 id=&quot;프로젝트-추가&quot;&gt;프로젝트 추가&lt;/h3&gt;

&lt;p&gt;Firebase 프로젝트 추가에 앞서 Firebase를 사용하려면 google 계정이 필요하다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;google 계정으로 로그인 한다.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://console.firebase.google.com/&quot;&gt;Firebase console&lt;/a&gt;로 이동한다.&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;프로젝트 추가&lt;/code&gt;를 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_01_01.png&quot; alt=&quot;프로젝트 추가&quot; width=&quot;30%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;프로젝트 이름&lt;/code&gt;을 입력하고 &lt;code&gt;국가/지역&lt;/code&gt;을 선택한 뒤 &lt;code&gt;프로젝트 만들기&lt;/code&gt;를 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_01_02.png&quot; alt=&quot;프로젝트 추가&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;프로젝트-설정&quot;&gt;프로젝트 설정&lt;/h3&gt;
&lt;p&gt;Firebase를 클라이언트(Android, iOS, Web)에서 사용하려면 설정을 추가하면 된다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;여기서는 iOS로 설명하지만 Android라고 크게 다를건 없다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;Project Overview&lt;/code&gt; 메뉴 옆에 기어 모양 설정 버튼을 클릭하고 프로젝트 설정을 클릭한다.
  &lt;img src=&quot;/images/fb_01_03_1.png&quot; alt=&quot;프로젝트 설정&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;일반 탭에서 하단의 &lt;code&gt;iOS 앱에 Firebase 추가&lt;/code&gt; 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_01_03_2.png&quot; alt=&quot;iOS 추가&quot; width=&quot;20%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;iOS 번들 ID&lt;/code&gt;를 입력하고 나머지 선택사항도 필요에 따라 입력한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_01_03_3.png&quot; alt=&quot;입력&quot; width=&quot;30%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;GoogleService-Info.plist&lt;/code&gt; 파일을 다운받고 계속 버튼을 눌러 등록 과정을 마친다.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;익명-로그인&quot;&gt;익명 로그인&lt;/h2&gt;
&lt;p&gt;익명 로그인이 요구하는 사항은 간단하다. 여러가지 정보를 취합해서 게임 내에서 사용자를 고유하게 인식할 수 있으면 된다. 다음 절차로 진행된다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;사용자) 익명 로그인 버튼 클릭&lt;/li&gt;
  &lt;li&gt;게임 클라이언트) Firebase 인증 SDK에 익명 로그인 요청&lt;/li&gt;
  &lt;li&gt;Firebase) 여러가지 정보 확인 후 고유한 사용자 ID 반환&lt;/li&gt;
  &lt;li&gt;게임 클라이언트) 고유한 사용자 ID 사용&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;프로그래밍-준비&quot;&gt;프로그래밍 준비&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;먼저 간단한 UI를 추가해놓은 아래 Unity Project를 다운 받는다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/totuworld/firebase_toturial/archive/base.zip&quot;&gt;샘플 프로젝트&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Firebase SDK를 다운받아서 Firebase Auth SDK를 설치한다. 그리고 앞서 Firebase 프로젝트에서 다운받은 &lt;code&gt;GoogleService-Info.plist&lt;/code&gt;나 &lt;code&gt;google-services.json&lt;/code&gt;을 추가한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Firebase의 Authentication 메뉴에서 &lt;code&gt;로그인 방법&lt;/code&gt; 탭을 클릭한 뒤 &lt;code&gt;익명&lt;/code&gt; 사용 설정한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_02_02_01.png&quot; alt=&quot;Authentication&quot; width=&quot;30%&quot; /&gt;
  &lt;img src=&quot;/images/fb_02_02_02.png&quot; alt=&quot;익명 사용 설정&quot; width=&quot;80%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;익명-로그인-구현&quot;&gt;익명 로그인 구현&lt;/h3&gt;
&lt;p&gt;Firebase 인증을 활용할 때 초기화 후 익명 로그인 요청을 해야한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;unity 프로젝트의 프로젝트 탭에서 scripts 폴더를 만들고 &lt;code&gt;gfb_auth_test&lt;/code&gt;란 이름의 새로운 c# script 파일을 생성한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;이름은 달라도 무방하다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;추가한 스크립트를 편집할 수 있게 더블 클릭한 후 아래 코드를 복사하여 붙여넣는다.
    &lt;ul&gt;
      &lt;li&gt;4~7번: using으로 필요한 네임스페이스 형식 사용 허용&lt;/li&gt;
      &lt;li&gt;11~18번: 필요한 필드 추가&lt;/li&gt;
      &lt;li&gt;23~49번: &lt;code&gt;auth&lt;/code&gt;필드를 추가하고 상태변화 시 로그가 남도록 AuthStateChanged 메서드 연결.&lt;/li&gt;
      &lt;li&gt;52~69번: 익명 로그인을 요청하는 메서드&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;script src=&quot;https://gist.github.com//785a451847aebd36a548061a47cf261a.js?file=gfb_auth_test.cs&quot;&gt; &lt;/script&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;unity 프로젝트로 돌아가서 &lt;code&gt;test&lt;/code&gt;씬의 &lt;code&gt;Main Camera&lt;/code&gt; 게임 오브젝트에 &lt;code&gt;gfb_auth_test&lt;/code&gt; 스크립트를 추가한다. Canvas - Scroll View - ViewPort - Content 게임 오브젝트를 &lt;code&gt;gfb_auth_test&lt;/code&gt;의 Txt Print에 연결한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_02_03.png&quot; alt=&quot;게임 오브젝트 연결&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;guest login 버튼을 클릭했을 때 gfb_auth_test의 &lt;code&gt;anoymousLogin&lt;/code&gt; 메서드가 실행되어야 익명 로그인을 시도할 수 있다.&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Canvas - Button 게임 오브젝트의 Button 컴포넌트를 찾는다.&lt;/li&gt;
      &lt;li&gt;On Click의 + 버튼을 클릭한 뒤 Main Camera 게임 오브젝트를 연결한다.&lt;/li&gt;
      &lt;li&gt;gfb_auth_test 스크립트의 anoymousLogin을 선택한다.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;img src=&quot;/images/fb_02_04.png&quot; alt=&quot;버튼 연결&quot; width=&quot;50%&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;디버깅&quot;&gt;디버깅&lt;/h3&gt;

&lt;p&gt;unity 프로젝트에서 &lt;code&gt;play&lt;/code&gt; 버튼을 클릭하여 작동 시킨 뒤 화면 중앙에 나타나는 &lt;code&gt;guest login&lt;/code&gt; 버튼을 클릭한다. 아래 스크롤뷰에 즉시 &lt;code&gt;Sign in...&lt;/code&gt; 메시지가 출력된다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;모바일 앱으로 빌드해서 확인하려면 앞서 다운받은 &lt;code&gt;GoogleService-Info.plist&lt;/code&gt;나 &lt;code&gt;google-services.json&lt;/code&gt; 파일을 반드시 프로젝트에 추가해야한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;모바일 앱으로 빌드해서 해당 과정을 진행하면 Firebase console에 아래처럼 익명 사용자가 등록되는 것을 확인할 수 있다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/fb_02_05.png&quot; alt=&quot;익명 사용자 확인&quot; width=&quot;80%&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;마무리&quot;&gt;마무리&lt;/h2&gt;

&lt;p&gt;Firebase 인증을 활용하여 익명 로그인을 만들어봤다. 이를 바탕으로 다음에는 소셜 로그인 기능을 추가해보자.&lt;/p&gt;
</description>
            <pubDate>Thu, 22 Mar 2018 09:00:00 +0900</pubDate>
            <link />https://blog.totu.dev/2018/03/22/firebaseandunity-01/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2018/03/22/firebaseandunity-01/</guid>
            
            
            <category>nodejs</category>
            
            <category>firebase</category>
            
            <category>unity</category>
            
        </item>
      
    
      
        <item>
            <title>이세계에 진입한 서버 개발 - 7</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#인앱-결제-영수증-검증&quot; id=&quot;markdown-toc-인앱-결제-영수증-검증&quot;&gt;인앱 결제 영수증 검증&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#모델-추가&quot; id=&quot;markdown-toc-모델-추가&quot;&gt;모델 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#라우터-추가&quot; id=&quot;markdown-toc-라우터-추가&quot;&gt;라우터 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#appjs에-등록&quot; id=&quot;markdown-toc-appjs에-등록&quot;&gt;app.js에 등록&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#로직-추가&quot; id=&quot;markdown-toc-로직-추가&quot;&gt;로직 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#에러-추가&quot; id=&quot;markdown-toc-에러-추가&quot;&gt;에러 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#utilscommonfuncjs에-메서드-추가&quot; id=&quot;markdown-toc-utilscommonfuncjs에-메서드-추가&quot;&gt;utils/commonFunc.js에 메서드 추가&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#구글-권한-처리&quot; id=&quot;markdown-toc-구글-권한-처리&quot;&gt;구글 권한 처리&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#필요사항-준비&quot; id=&quot;markdown-toc-필요사항-준비&quot;&gt;필요사항 준비&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#모델-추가-1&quot; id=&quot;markdown-toc-모델-추가-1&quot;&gt;모델 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#라우터-추가-1&quot; id=&quot;markdown-toc-라우터-추가-1&quot;&gt;라우터 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#appjs에-등록-1&quot; id=&quot;markdown-toc-appjs에-등록-1&quot;&gt;app.js에 등록&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#utilsauthjs-내용-추가&quot; id=&quot;markdown-toc-utilsauthjs-내용-추가&quot;&gt;utils/auth.js 내용 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#utilscommonfuncjs-내용-추가&quot; id=&quot;markdown-toc-utilscommonfuncjs-내용-추가&quot;&gt;utils/commonFunc.js 내용 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#에러-추가-1&quot; id=&quot;markdown-toc-에러-추가-1&quot;&gt;에러 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#redirect_uri-추가&quot; id=&quot;markdown-toc-redirect_uri-추가&quot;&gt;REDIRECT_URI 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#테스트&quot; id=&quot;markdown-toc-테스트&quot;&gt;테스트&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#데이터-입력&quot; id=&quot;markdown-toc-데이터-입력&quot;&gt;데이터 입력&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#영수증-검증-테스트&quot; id=&quot;markdown-toc-영수증-검증-테스트&quot;&gt;영수증 검증 테스트&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#테스트-관리자-계정-추가&quot; id=&quot;markdown-toc-테스트-관리자-계정-추가&quot;&gt;테스트 관리자 계정 추가&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#vs-code-개발-환경-설정&quot; id=&quot;markdown-toc-vs-code-개발-환경-설정&quot;&gt;vs code 개발 환경 설정&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#브라우저로-권한-요청&quot; id=&quot;markdown-toc-브라우저로-권한-요청&quot;&gt;브라우저로 권한 요청&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#웹-작업webjob-등록&quot; id=&quot;markdown-toc-웹-작업webjob-등록&quot;&gt;웹 작업(WebJob) 등록&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#소스코드-편집&quot; id=&quot;markdown-toc-소스코드-편집&quot;&gt;소스코드 편집&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#웹-작업-추가&quot; id=&quot;markdown-toc-웹-작업-추가&quot;&gt;웹 작업 추가&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#맺음말&quot; id=&quot;markdown-toc-맺음말&quot;&gt;맺음말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#참고자료&quot; id=&quot;markdown-toc-참고자료&quot;&gt;참고자료&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/HzjtOTH0aMY&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;

&lt;p&gt;내가 쓴 글 중 &lt;code&gt;구글 인앱 결제 검증 웹 서비스 만들기&lt;/code&gt;가 가장 인기 있다. 꾸준히 찾는 사람이 있다.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;이세계에 진입한 서버 개발&lt;/code&gt; 연재가 시작된 후로도 최고 조회수 3위 안에 든다.&lt;/p&gt;

&lt;p&gt;그런데 해당 글에는 자원을 다루는 내용과 연계되지 못해 반쪽짜리였다.&lt;/p&gt;

&lt;p&gt;인앱 결제 영수증 검증을 했어도 자원을 클라이언트에서 관리하게되면 메모리 조작 등으로 방지해도 방지한게 아닌 상태가 된다.&lt;/p&gt;

&lt;p&gt;이 시간에는 인앱 결제 영수증 검증과 자원 지급을 묶어서 처리하도록 한다.&lt;/p&gt;

&lt;h2 id=&quot;인앱-결제-영수증-검증&quot;&gt;인앱 결제 영수증 검증&lt;/h2&gt;

&lt;p&gt;인앱 결제 후 영수증 검증 과정은 다음과 같다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy07_07.png&quot; alt=&quot;인앱영수증검증&quot; width=&quot;500px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;서버 사이드에서 처리하는 일은 인앱 영수증 검증을 요청하고, 자원을 지급하는 것이다.&lt;/p&gt;

&lt;h3 id=&quot;모델-추가&quot;&gt;모델 추가&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;models&lt;/code&gt; 폴더에 파일을 추가하고 각각 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto7.1/models/LogReceipt.js&quot;&gt;LogReceipt.js&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto7.1/models/DefineShop.js&quot;&gt;DefineShop.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;LogReceipt&lt;/code&gt;는 검증 요청한 영수증을 저장한다. &lt;code&gt;DefineShop&lt;/code&gt;은 상점을 관리할 때 사용한다. 여기서는 인앱 결제로 사용되는 상품을 나타내도록 한다.&lt;/p&gt;

&lt;h3 id=&quot;라우터-추가&quot;&gt;라우터 추가&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;routes&lt;/code&gt;폴더에 &lt;code&gt;receipt.js&lt;/code&gt; 파일을 추가하고 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto7.5/routes/receipt.js&quot;&gt;routes/receipt.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;appjs에-등록&quot;&gt;app.js에 등록&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;app.js&lt;/code&gt; 파일을 수정하여 receipt 라우터를 추가해보자.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;app.js&lt;/code&gt;에서 아래 내용을 찾아서 그 아래쪽에 코드를 추가한다.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;찾아야하는 내용&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  const routes = require(&#39;./routes/index&#39;);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;추가할 코드&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  const receipt = require(&#39;./routes/receipt&#39;);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;app.js&lt;/code&gt;에서 아래 내용을 찾아서 그 아래쪽에 코드를 추가한다.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;찾아야하는 내용&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  app.use(&#39;/&#39;, routes);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;추가할 코드&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  app.use(&#39;/receipt&#39;, receipt);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;로직-추가&quot;&gt;로직 추가&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;logics&lt;/code&gt; 폴더에 &lt;code&gt;validationReceipt.js&lt;/code&gt; 파일을 추가하고 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto7.5/logics/validationReceipt.js&quot;&gt;logics/validationReceipt.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;애플, 구글, 원스토어의 영수증을 검정할 때 사용하는 로직을 모아두었다.&lt;/p&gt;

&lt;p&gt;각 로직은 마켓 서버에 HTTP로 검증 요청을 보내게되므로 request 모듈을 새로 추가해야한다.&lt;/p&gt;

&lt;p&gt;프로젝트 폴더에서 아래 명령을 입력한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;$ yarn add request
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;에러-추가&quot;&gt;에러 추가&lt;/h3&gt;
&lt;p&gt;에러코드를 추가한다. &lt;code&gt;utils/error.js&lt;/code&gt;에 아래 클래스를 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;
/** 80701 */
class UnsupportedReceiptType extends CustomError {
    constructor() {
        let message = &#39;지원하지 않거나 존재하지 않는 영수증타입(ReceipType)&#39;;
        let code = 80701;
        super(message, code);
    }
}

/** 80702 */
class InitializationFirst extends CustomError {
    constructor() {
        let message = &#39;초기화를 먼저 진행해야한다.&#39;;
        let code = 80702;
        super(message, code);
    }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;utils/error.js&lt;/code&gt;의 &lt;code&gt;errorMap&lt;/code&gt; 오브젝트에 추가할 클래스를 등록한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;추가할 때 이전의 마지막 부분 - 여기서는 NoLongerUpgrade - 에 콤마(,)를 추가하여야 한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;&quot;UnsupportedReceiptType&quot;:UnsupportedReceiptType,
&quot;InitializationFirst&quot;:InitializationFirst

&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;utilscommonfuncjs에-메서드-추가&quot;&gt;utils/commonFunc.js에 메서드 추가&lt;/h3&gt;

&lt;p&gt;오브젝트에 원하는 프로퍼티가 하나라도 있는지 체크하는 메서드를 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;/**
 * object에 key가 적어도 하나라도 포함되어있는지 체크.
 */
exports.ObjectIncludeOneKey = (obj, keyArr)=&amp;gt;{
    for(let argValue of keyArr) {
        if(obj.hasOwnProperty(argValue) === true)
            return true;
    }
    return false;
}

&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;구글-권한-처리&quot;&gt;구글 권한 처리&lt;/h2&gt;

&lt;p&gt;검증과 관련된 부분은 완료되었다. 그러나 문제가 하나 있다.&lt;/p&gt;

&lt;p&gt;애플과 원스토어는 별도의 권한없이 영수증 확인이 가능하다. 구글은 권한이 필요하다.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.totu.dev/2016/02/10/google-oauth/#필요사항-준비&quot;&gt;구글 인앱 결제 검증 웹 서비스 만들기&lt;/a&gt;에서도 많은 부분이 이 내용이었다.&lt;/p&gt;

&lt;p&gt;길고 지루하겠지만 다음 과정을 진행해보자.&lt;/p&gt;

&lt;h3 id=&quot;필요사항-준비&quot;&gt;필요사항 준비&lt;/h3&gt;
&lt;p&gt;구글 개발자 콘솔에서 &lt;code&gt;OAuth&lt;/code&gt;로 사용자를 인증하는 아이디를 등록해서 &lt;code&gt;CLIENT_ID&lt;/code&gt;, &lt;code&gt;CLIENT_SECRET&lt;/code&gt;를 얻는 과정을 알아보자.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://play.google.com/apps/publish/#ApiAccessPlace&quot;&gt;구글 플레이 개발자 콘솔&lt;/a&gt;에 접속한 후 &lt;code&gt;API 액세스&lt;/code&gt; 페이지로 이동한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;처음 사용 시 신규 프로젝트를 생성하거나 기존에 등록된 것이 있다면 원하는 것을 선택하고 링크를 클릭한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2번 과정을 통해 &lt;a href=&quot;https://console.developers.google.com/apis&quot;&gt;구글 개발자 콘솔&lt;/a&gt;에 접속한 후 &lt;code&gt;API 관리자&lt;/code&gt;에 도달했다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;사용자 인증 정보 - 새 사용자 인증 정보&lt;/code&gt; 버튼을 클릭하고 &lt;code&gt;OAuth 클라이언트 ID&lt;/code&gt;를 선택한다.&lt;br /&gt;
 &lt;img src=&quot;/images/OAuth_clientid.png&quot; alt=&quot;OAuth 클라이언트 ID 생성&quot; width=&quot;500px&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;웹 어플리케이션&lt;/code&gt;을 선택하고 &lt;code&gt;이름&lt;/code&gt;을 입력한 후 &lt;code&gt;생성&lt;/code&gt;버튼을 클릭한다.
 &lt;img src=&quot;/images/OAuth_clientid1.png&quot; alt=&quot;클라이언트 ID 만들기&quot; width=&quot;340px&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;생성이 완료되면 &lt;code&gt;클라이언트 ID&lt;/code&gt;와 &lt;code&gt;클라이언트 보안 비밀&lt;/code&gt;이 출력된다.
 &lt;img src=&quot;/images/OAuth_clientid2.png&quot; alt=&quot;클라이언트 ID 확인&quot; width=&quot;500px&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;이로써 &lt;code&gt;CLIENT_ID&lt;/code&gt;, &lt;code&gt;CLIENT_SECRET&lt;/code&gt;는 확보되었다. &lt;code&gt;REDIRECT_URL&lt;/code&gt;은 이후 과정에서 추가하기로 하고 넘어가자.&lt;/p&gt;

&lt;h3 id=&quot;모델-추가-1&quot;&gt;모델 추가&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;models&lt;/code&gt; 폴더에 파일을 추가하고 각각 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto7.2/models/AdminUser.js&quot;&gt;AdminUser.js&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto7.2/models/AuthGoogle.js&quot;&gt;AuthGoogle.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;관리자 계정을 등록할 수 있도록 &lt;code&gt;AdminUser&lt;/code&gt;를 추가했다. 구글 권한 획득 내용을 기록할 수 있도록 &lt;code&gt;AuthGoogle&lt;/code&gt;을 추가했다.&lt;/p&gt;

&lt;h3 id=&quot;라우터-추가-1&quot;&gt;라우터 추가&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;routes&lt;/code&gt;폴더에 &lt;code&gt;auth.js&lt;/code&gt; 파일을 추가하고 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto7.2/routes/auth.js&quot;&gt;routes/auth.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;appjs에-등록-1&quot;&gt;app.js에 등록&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;app.js&lt;/code&gt; 파일을 수정하여 auth 라우터를 추가해보자.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;app.js&lt;/code&gt;에서 아래 내용을 찾아서 그 아래쪽에 코드를 추가한다.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;찾아야하는 내용&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  const routes = require(&#39;./routes/index&#39;);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;추가할 코드&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  const auth = require(&#39;./routes/auth&#39;);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;app.js&lt;/code&gt;에서 아래 내용을 찾아서 그 아래쪽에 코드를 추가한다.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;찾아야하는 내용&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  app.use(&#39;/&#39;, routes);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;추가할 코드&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  app.use(&#39;/auth&#39;, auth);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;utilsauthjs-내용-추가&quot;&gt;utils/auth.js 내용 추가&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;utils/auth.js&lt;/code&gt;에 다음 내용을 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;const crypto = require(&#39;crypto&#39;);
const cryptoPassword = 
    process.env.cryptoPassword || &#39;wendy&#39;;

exports.encryptPassword = (password)=&amp;gt;{
    let hash = crypto.createHash(&#39;sha256&#39;)
        .update(cryptoPassword).digest(&#39;base64&#39;);
    return hash;
}

exports.isAdminAuthenticated = (req, res, next)=&amp;gt;{
    jwt.verify(req.headers.authorization, SECRET, (err, decoded)=&amp;gt;{
        if(err || decoded.grade &amp;lt; 10) {
            let error = wendyError(&#39;CredentialFailure&#39;);
            res.status(401).send({result:error.code, message:error.message});
        }
        else {
            req.admin = {
                email:decoded.email,
                grade:decoded.grade
            };
            return next();
        }
    });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;utilscommonfuncjs-내용-추가&quot;&gt;utils/commonFunc.js 내용 추가&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;utils/commonFunc.js&lt;/code&gt;에 다음 내용을 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;const emailRegEx = /^(([^&amp;lt;&amp;gt;()\[\]\\.,;:\s@&quot;]+(\.[^&amp;lt;&amp;gt;()\[\]\\.,;:\s@&quot;]+)*)|(&quot;.+&quot;))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

exports.checkEmail = (email)=&amp;gt;{
    return emailRegEx.test(email);
}

const passwordRegEx = /^(?=.*[a-zA-Z])((?=.*\d)|(?=.*\W)).{8,16}$/

exports.checkPassword = (password)=&amp;gt;{
    return passwordRegEx.test(password);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;에러-추가-1&quot;&gt;에러 추가&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;utils/error.js&lt;/code&gt;에 아래 클래스를 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;/** 99201 */
class WrongEmailOrPassword extends CustomError {
    constructor() {
        let message = &#39;email 이나 password가 없거나 틀렸다.&#39;;
        let code = 99201;
        super(message, code);
    }
}

/** 99202 */
class UsedEmail extends CustomError {
    constructor() {
        let message = &#39;이미 사용중인 email&#39;;
        let code = 99202;
        super(message, code);
    }
}

/** 99203 */
class WrongEmail extends CustomError {
    constructor() {
        let message = &#39;email 형식이 아니다&#39;;
        let code = 99203;
        super(message, code);
    }
}

/** 99204 */
class WrongPassword extends CustomError {
    constructor() {
        let message = &#39;password는 최소 1개의 숫자 혹은 특수문자를 포함한 8~16자리여야 한다&#39;;
        let code = 99204;
        super(message, code);
    }
}

/** 99205 */
class LockdownUserAccess extends CustomError {
    constructor() {
        let message = &#39;password 입력 실패 5회로 권한 박탈, 관리자에게 문의!&#39;;
        let code = 99205;
        super(message, code);
    }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;utils/error.js&lt;/code&gt;의 &lt;code&gt;errorMap&lt;/code&gt; 오브젝트에 추가할 클래스를 등록한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;추가할 때 이전의 마지막 부분 - 여기서는 NoLongerUpgrade - 에 콤마(,)를 추가하여야 한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;&quot;WrongEmailOrPassword&quot;:WrongEmailOrPassword,
&quot;UsedEmail&quot;:UsedEmail,
&quot;WrongEmail&quot;:WrongEmail,
&quot;WrongPassword&quot;:WrongPassword,
&quot;LockdownUserAccess&quot;:LockdownUserAccess,

&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;redirect_uri-추가&quot;&gt;REDIRECT_URI 추가&lt;/h3&gt;

&lt;p&gt;필요사항을 준비할 때 빼놓은 &lt;code&gt;REDIRECT_URI&lt;/code&gt;을 등록해보자.&lt;/p&gt;

&lt;p&gt;Azure 웹앱의 hostname을 기억한다면 &lt;code&gt;/auth/google/return&lt;/code&gt; 패스를 더해 아래와 같은 형태가 된다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;hostname/auth/google/return&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;로컬 개발 환경에서는 ngrok을 활용할 수 있다.&lt;/p&gt;

&lt;p&gt;ngrok은 외부에서 내 컴퓨터에 접근할 수 있도록 터널을 뚫어준다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://ngrok.com/static/img/demo.png&quot; alt=&quot;ngrok 개념&quot; width=&quot;500px&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://blog.outsider.ne.kr/1159&quot;&gt;ngrok으로 로컬 네트워크의 터널 열기&lt;/a&gt;에 자세히 설명되어있음.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://ngrok.com/download&quot;&gt;ngrok을 설치&lt;/a&gt;한 후 포트를 열도록 한다.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    $ ./ngrok http 3000
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;p&gt;osx나 linux 환경에서는 path에 등록되지 않았을 때 ngrok이 위치한 폴더에서 위와 같이 입력한다. path에 등록되어있다면 &lt;code&gt;./&lt;/code&gt;는 제거한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;포트가 열리면 아래처럼 주소가 나온다. 해당 주소를 hostname으로 사용하면 된다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code&gt;Azure 웹앱&lt;/code&gt;에서 사용할 때는 hostname이 웹앱의 URL로 대치되어야한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy07_02.png&quot; alt=&quot;ngrok 포트 개방 예시&quot; width=&quot;500px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;redirect_uri&lt;/code&gt;에 입력한 주소를 &lt;a href=&quot;https://console.developers.google.com/apis&quot;&gt;구글 개발자 콘솔 API 관리자&lt;/a&gt;에 접속하여 등록해야한다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy07_01.png&quot; alt=&quot;redirect uri 업데이트&quot; width=&quot;500px&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;테스트&quot;&gt;테스트&lt;/h3&gt;

&lt;h4 id=&quot;데이터-입력&quot;&gt;데이터 입력&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;DefineShop&lt;/code&gt; 테이블에 데이터를 입력한다.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;ShopID&lt;/th&gt;
      &lt;th&gt;ProductName&lt;/th&gt;
      &lt;th&gt;PriceType&lt;/th&gt;
      &lt;th&gt;Price&lt;/th&gt;
      &lt;th&gt;RewardSetGroupID&lt;/th&gt;
      &lt;th&gt;RewardGoodsGroupID&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;NULL&lt;/td&gt;
      &lt;td&gt;test&lt;/td&gt;
      &lt;td&gt;20&lt;/td&gt;
      &lt;td&gt;0.99&lt;/td&gt;
      &lt;td&gt;6001&lt;/td&gt;
      &lt;td&gt;NULL&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;영수증-검증-테스트&quot;&gt;영수증 검증 테스트&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;패스 : POST&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;URL : localhost:3000/receipt/validation/apple&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Headers : Authorization을 추가하고 토큰 내용을 value 부분에 넣는다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;body : 아래 내용을 넣는다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/develope/test/samplereceipt.json&quot;&gt;samplereceipt.json&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;정상적으로 요청되면 아래와 같은 형식의 결과를 확인할 수 있다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-json&quot;&gt;{
  &quot;result&quot;: 0,
  &quot;reward&quot;: {
    &quot;item&quot;: [],
    &quot;currency&quot;: [
      {
        &quot;TotalQNTY&quot;: 900000,
        &quot;OwnCurrencyUID&quot;: 7,
        &quot;CurrencyID&quot;: 103,
        &quot;CurrentQNTY&quot;: 1217,
        &quot;NowMaxQNTY&quot;: 900000,
        &quot;AddMaxQNTY&quot;: 0,
        &quot;UpdateTimeStamp&quot;: &quot;2017-02-21T00:00:00.000Z&quot;,
        &quot;GameUserID&quot;: 1
      }
    ]
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;테스트-관리자-계정-추가&quot;&gt;테스트 관리자 계정 추가&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;패스 : POST&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;URL : localhost:3000/auth/add&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;body : 아래 내용을 넣는다.&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-json&quot;&gt;{
	&quot;email&quot;:&quot;totuworld@gmail.com&quot;,
	&quot;password&quot;:&quot;test1234&quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;p&gt;테스트용으로 추가한 것이다. 운영할 때 복잡한 패스워드를 사용하고 절대 공개하면 안된다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;별도의 관리툴이 없으므로 DBeaver로 &lt;code&gt;AdminUser&lt;/code&gt;테이블로 접근한 뒤 &lt;code&gt;grade&lt;/code&gt;를 10으로 조정한다.&lt;/p&gt;

&lt;h4 id=&quot;vs-code-개발-환경-설정&quot;&gt;vs code 개발 환경 설정&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;.vscode/launch.json&lt;/code&gt;에서 &lt;code&gt;env&lt;/code&gt;노드를 찾아서 아래 3가지 환경변수를 추가한다.&lt;/p&gt;

&lt;p&gt;여기서 &lt;code&gt;hostname&lt;/code&gt;은 ngrok을 통해 얻은 hostname을 입력해야한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-json&quot;&gt;                &quot;authAOSClientID&quot;:&quot;{클라이언트 id}&quot;,
                &quot;authAOSClientSecret&quot;:&quot;{클라이언트 secret}&quot;,
                &quot;authAOSRedirectURI&quot;:&quot;{hostname}/auth/google/return&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;p&gt;콤마(,)추가를 잊지 말자!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;눈치가 빠른 사람이라면 알겠지만 &lt;code&gt;Azure 웹앱&lt;/code&gt;에도 환경 변수 등록을 해야한다. 단 hostname은 웹앱의 URL를 넣어야한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;브라우저로-권한-요청&quot;&gt;브라우저로 권한 요청&lt;/h4&gt;

&lt;p&gt;vs code에서 실행한 뒤 브라우저로 아래 주소로 접속한다.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://localhost:3000/auth/google/start&quot;&gt;localhost:3000/auth/google/start&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy07_03.png&quot; alt=&quot;오프라인액세스권한&quot; width=&quot;300px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;허용&lt;/code&gt; 버튼을 클릭하면 아래처럼 토큰을 얻을 수 있다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-json&quot;&gt;{
    &quot;access_token&quot;: &quot;ya29.Glhaha&quot;,
    &quot;expires_in&quot;: 3600,
    &quot;refresh_token&quot;: &quot;1/o8-U9haha&quot;,
    &quot;token_type&quot;: &quot;Bearer&quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;웹-작업webjob-등록&quot;&gt;웹 작업(WebJob) 등록&lt;/h2&gt;
&lt;p&gt;Google 권한 요청으로 얻은 토큰은 1시간 동안만 유효하다. 실제로 서비스가 이뤄지고 있다면 지속적인 갱신이 필요하다.&lt;/p&gt;

&lt;p&gt;Azure 웹앱은 이러한 작업을 &lt;code&gt;웹 작업&lt;/code&gt;(WebJob)으로 해결하도록 도와준다.&lt;/p&gt;

&lt;h3 id=&quot;소스코드-편집&quot;&gt;소스코드 편집&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;아래 링크로 웹 작업용 소스코드를 다운받는다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/totuworld/Wendy-webjob/archive/0.0.1.zip&quot;&gt;Wendy-webjob&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;소스코드에서 server.js 파일의 3가지 변수를 수정한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;let email = &#39;&#39;;
let password = &#39;&#39;;
let hostname = &#39;&#39;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;앞선 예시를 반영하면 아래와 같이 변경한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;let email = &#39;totuworld@gmail.com&#39;;
let password = &#39;test1234&#39;;
let hostname = &#39;Azure 웹앱 URL&#39;;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;모듈을 설치한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;$ yarn install
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;전체 폴더를 압축한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;이때 반드시 &lt;code&gt;Wendy-webjob&lt;/code&gt;압축해제한 폴더 내부에서 모든 파일 및 폴더를 선택한 뒤 압축한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;아래 이미지의 테두리가 있는 부분처럼 선택해야한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy07_08.png&quot; alt=&quot;폴더선택&quot; width=&quot;300px&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;웹-작업-추가&quot;&gt;웹 작업 추가&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://portal.azure.com&quot;&gt;Azure 포털(https://portal.azure.com)로 접속&lt;/a&gt;한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;이전에 생성한 웹앱을 선택한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;왼쪽 설정 메뉴 하단에 &lt;code&gt;웹 작업&lt;/code&gt;을 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/rvwendy07_04.png&quot; alt=&quot;웹작업&quot; width=&quot;200px&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;상단의 &lt;code&gt;추가&lt;/code&gt; 버튼을 클릭한다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/rvwendy07_05.png&quot; alt=&quot;웹작업추가&quot; width=&quot;120px&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;이름&lt;/code&gt;을 입력하고 앞서 생성한 압축 파일을 선택한다. &lt;code&gt;형식&lt;/code&gt;을 &lt;code&gt;트리거됨&lt;/code&gt;으로 선택하고 20분마다 실행될 수 있도록 CRON 식을 아래 처럼 입력한다. &lt;code&gt;확인&lt;/code&gt; 버튼을 클릭하여 등록을 마친다.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/rvwendy07_06.png&quot; alt=&quot;웹작업&quot; width=&quot;300px&quot; /&gt;&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt; 0 0/20 * * * *
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;이렇게 등록된 웹 작업은 20분마다 Google 권한을 갱신 요청을 한다.&lt;/p&gt;

&lt;h2 id=&quot;맺음말&quot;&gt;맺음말&lt;/h2&gt;

&lt;p&gt;인앱 영수증을 검증하는 방법에 대해 알아봤다. Google은 다소 복잡한 권한 획득 과정이 필요하다. 실제 운영을 고려한다면 결제 전에 웹 서버로부터 develperPayload를 발급받아 결제를 진행해서 영수증에 함께 나오도록하여 검증 단계를 강화하는 것도 고려해야한다.&lt;/p&gt;

&lt;p&gt;인앱 결제를 크랙하려는 시도는 다양하므로 자물쇠를 더 단단히 걸어둘 필요가 있다.&lt;/p&gt;

&lt;p&gt;1차 - 혹은 1기 - 완료 목표였던 7강이 완료되었다.&lt;/p&gt;

&lt;p&gt;2016년 12월 말부터 2017년 3월 초까지 약 2달 조금 넘는 시간 동안 새벽을 허락해준 아내, &lt;code&gt;좋아요&lt;/code&gt;와 &lt;code&gt;공유&lt;/code&gt;, &lt;code&gt;댓글&lt;/code&gt;로 응원해준 모든 분에게 감사의 인사를 전한다.&lt;/p&gt;

&lt;p&gt;2차 - 혹은 2기 - 는 도적같이 찾아오도록 하겠다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;참고자료&quot;&gt;참고자료&lt;/h2&gt;
&lt;p&gt;완성된 소스코드는 아래 링크에서 다운로드받으면 된다.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/totuworld/Wendy/archive/0.0.6.zip&quot;&gt;Wendy 7강 완료 버전&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Tue, 07 Mar 2017 04:01:00 +0900</pubDate>
            <link />https://blog.totu.dev/2017/03/07/azureunity-07/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2017/03/07/azureunity-07/</guid>
            
            
            <category>nodejs</category>
            
            <category>azure</category>
            
            <category>webapps</category>
            
            <category>unity</category>
            
        </item>
      
    
      
        <item>
            <title>아빠 출근한다</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#때는-바야흐로-2016년&quot; id=&quot;markdown-toc-때는-바야흐로-2016년&quot;&gt;때는 바야흐로 2016년&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#회사의-인상은-사소한-것으로-결정된다&quot; id=&quot;markdown-toc-회사의-인상은-사소한-것으로-결정된다&quot;&gt;회사의 인상은 사소한 것으로 결정된다.&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#소규모-회사&quot; id=&quot;markdown-toc-소규모-회사&quot;&gt;소규모 회사&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#상대적으로-큰-회사&quot; id=&quot;markdown-toc-상대적으로-큰-회사&quot;&gt;상대적으로 큰 회사&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#게임-회사&quot; id=&quot;markdown-toc-게임-회사&quot;&gt;게임 회사&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#획기적인-경험&quot; id=&quot;markdown-toc-획기적인-경험&quot;&gt;획기적인 경험&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#맺음말&quot; id=&quot;markdown-toc-맺음말&quot;&gt;맺음말&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;때는-바야흐로-2016년&quot;&gt;때는 바야흐로 2016년&lt;/h2&gt;

&lt;p&gt;재미있게 지내던 회사가 어쩔 수 없는 이유로 문을 닫게 되었다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;첫 프로젝트가 결실을 맺어 차기 프로젝트로 한번 더 손발을 맞춰볼 수 있기를 바랐지만…&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;2017년 백수가 되었다. 취직하려고 이력서를 보내기 시작했다.&lt;/p&gt;

&lt;h2 id=&quot;회사의-인상은-사소한-것으로-결정된다&quot;&gt;회사의 인상은 사소한 것으로 결정된다.&lt;/h2&gt;

&lt;p&gt;지난 회사가 잘한 일은 입사 지원 시 &lt;code&gt;빠른 피드백&lt;/code&gt;, &lt;code&gt;면접비&lt;/code&gt;, &lt;code&gt;기다리지 않게하기&lt;/code&gt; 였다.&lt;/p&gt;

&lt;p&gt;입사 지원 메일 수신을 빠르게 피드백했고 면접 날짜 등을 조율하는 것 정확했다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;같이 일한 동료 중에 이런 회사는 아라소판단 뿐이었다고 말할 정도로 잘했다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;면접이 있는지 몰라 안내를 못하는 일은 없었다.&lt;/p&gt;

&lt;p&gt;그리고 작은 금액이라도 면접비가 지급되었다.&lt;/p&gt;

&lt;p&gt;이번에 이력서를 보낸 곳은 총 7곳이었다.&lt;/p&gt;

&lt;p&gt;2개 회사는 게임 회사이고 나머지는 웹 서비스를 제작하는 회사이다.&lt;/p&gt;

&lt;p&gt;3곳은 다른 회사에 비해서 규모가 컸다.&lt;/p&gt;

&lt;p&gt;그런데 규모와 상관없이 이런 연락이 늦거나 성의없는 대응을 보인 곳이 많았다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;메일 회신을 3주 후 한 곳도 있다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;소규모-회사&quot;&gt;소규모 회사&lt;/h3&gt;

&lt;p&gt;소규모 회사는 만나본 곳 모두 인상이 좋았다.&lt;/p&gt;

&lt;p&gt;일을 장악하고 있는 사람에게 풍기는 아우라랄까? 그런게 있었다.&lt;/p&gt;

&lt;p&gt;만나는 시간 자체가 즐거웠다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;그 중 한 회사 관계자는 개인적으로 친분을 유지하고 싶을만큼 대단했다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;상대적으로-큰-회사&quot;&gt;상대적으로 큰 회사&lt;/h3&gt;

&lt;p&gt;회사마다 인사 관리가 이뤄지는 것은 특별한 룰은 없겠지만 비교될 만큼 처리 속도와 성의가 다른 두 업체가 존재했다.&lt;/p&gt;

&lt;p&gt;한 곳은 기계가 보낸 이메일만 회신할 수 있었다.&lt;/p&gt;

&lt;p&gt;함께할 수 없다는 얘기조차 시스템 메일로 대체했다.&lt;/p&gt;

&lt;p&gt;다른 한 곳은 엄청난 속도로 면접까지 진행됐다. 이런 규모에서 이래도 되나 싶을만큼 빨랐다.&lt;/p&gt;

&lt;h3 id=&quot;게임-회사&quot;&gt;게임 회사&lt;/h3&gt;

&lt;p&gt;크기에 상관없이 모두 무성의했고 피드백도 느렸다.&lt;/p&gt;

&lt;p&gt;메일 회신 조차 없어서 놀랐다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;하긴 내가 별거 아닌 인간이긴 하다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;획기적인-경험&quot;&gt;획기적인 경험&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/flitto.png&quot; alt=&quot;인증샷&quot; /&gt;&lt;/p&gt;

&lt;p&gt;이번 구직과정에서 가장 미안한 마음이 든 곳은 &lt;code&gt;플리토&lt;/code&gt;였다.&lt;/p&gt;

&lt;p&gt;node.js를 서비스에 적용한 회사로 전부터 지켜봐왔던 터라 더욱 미안하다.&lt;/p&gt;

&lt;p&gt;구인을 조금 늦게 알았고 면접 제안이 왔을 때 이미 다른 회사에 출근확정을 한 상태였다.&lt;/p&gt;

&lt;p&gt;미안한 마음을 전하고 싶었다. 그러던 중 연락을 받아 급 만남을 가졌다.&lt;/p&gt;

&lt;p&gt;회사를 둘러보고 얘기를 나눌 수 있는 즐거운 경험이었다.&lt;/p&gt;

&lt;p&gt;면접를 거절한 구직자와 구인자가 마주 앉아서 얘기를 나누다니!!&lt;/p&gt;

&lt;p&gt;대인배란 이런 것인가?!&lt;/p&gt;

&lt;h2 id=&quot;맺음말&quot;&gt;맺음말&lt;/h2&gt;

&lt;p&gt;많은 구직자 중 한 명에게 어떤 인상을 주느냐는 회사 차원에서 사소한 일이다.&lt;/p&gt;

&lt;p&gt;사소함이 술자리에 오르고 티 테이블에 오른다.&lt;/p&gt;

&lt;p&gt;지인의 사소한 경험은 선입견을 만들 때 많은 힘이 있다.&lt;/p&gt;

&lt;p&gt;PR자료 돌리고 이미지 광고하는 것보다 사소한 일에 더 신경쓰면 좋겠다.&lt;/p&gt;
</description>
            <pubDate>Sun, 26 Feb 2017 09:00:00 +0900</pubDate>
            <link />https://blog.totu.dev/2017/02/26/job/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2017/02/26/job/</guid>
            
            
            <category>etc</category>
            
        </item>
      
    
      
        <item>
            <title>Wendy 프로젝트 진행사항 3</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#프로젝트-진행-사항&quot; id=&quot;markdown-toc-프로젝트-진행-사항&quot;&gt;프로젝트 진행 사항&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#기능-목록&quot; id=&quot;markdown-toc-기능-목록&quot;&gt;기능 목록&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#튜토리얼-제작-사항&quot; id=&quot;markdown-toc-튜토리얼-제작-사항&quot;&gt;튜토리얼 제작 사항&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#완성된-튜토리얼-목록&quot; id=&quot;markdown-toc-완성된-튜토리얼-목록&quot;&gt;완성된 튜토리얼 목록&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#튜토리얼-제작-진행사항&quot; id=&quot;markdown-toc-튜토리얼-제작-진행사항&quot;&gt;튜토리얼 제작 진행사항&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#소식들&quot; id=&quot;markdown-toc-소식들&quot;&gt;소식들&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#웬디-근황&quot; id=&quot;markdown-toc-웬디-근황&quot;&gt;웬디 근황&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#좋은-소식&quot; id=&quot;markdown-toc-좋은-소식&quot;&gt;좋은 소식&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#우울한-소식&quot; id=&quot;markdown-toc-우울한-소식&quot;&gt;우울한 소식&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#맺음말&quot; id=&quot;markdown-toc-맺음말&quot;&gt;맺음말&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;

&lt;p&gt;2017년 2월은 레드벨벳 웬디와 Wendy가 있어 행복하고 재미나다.&lt;/p&gt;

&lt;h2 id=&quot;프로젝트-진행-사항&quot;&gt;프로젝트 진행 사항&lt;/h2&gt;
&lt;p&gt;자원(통화, 아이템)을 관리할 수 있게 되고 지급 관리까지 제작되었다.&lt;/p&gt;

&lt;p&gt;서비스로 쿠폰도 제작!&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://github.com/totuworld/Wendy&quot;&gt;Wendy 프로젝트 레파지토리&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;기능-목록&quot;&gt;기능 목록&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;기기 관리&lt;/li&gt;
  &lt;li&gt;사용자 관리&lt;/li&gt;
  &lt;li&gt;통화 관리&lt;/li&gt;
  &lt;li&gt;아이템 관리&lt;/li&gt;
  &lt;li&gt;자원(통화, 아이템) 지급 관리&lt;/li&gt;
  &lt;li&gt;쿠폰&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;튜토리얼-제작-사항&quot;&gt;튜토리얼 제작 사항&lt;/h2&gt;
&lt;p&gt;2월에도 2개 강좌가 더 제작되었다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;5강 - 아이템 관리&lt;/li&gt;
  &lt;li&gt;6강 - 자원 지급 관리&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;완성된-튜토리얼-목록&quot;&gt;완성된 튜토리얼 목록&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;1강 - &lt;a href=&quot;https://blog.totu.dev/2016/12/21/azureandunity-01/&quot;&gt;Hello, world!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2강 - &lt;a href=&quot;https://blog.totu.dev/2016/12/29/azureandunity-02/&quot;&gt;SQL데이터베이스스와 환경설정&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;3강 - &lt;a href=&quot;https://blog.totu.dev/2017/01/12/azureandunity-03/&quot;&gt;기기와 사용자 관리&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;4강 - &lt;a href=&quot;https://blog.totu.dev/2017/01/26/azureandunity-04/&quot;&gt;통화관리&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;5강 - &lt;a href=&quot;https://blog.totu.dev/2017/02/09/azureandunity-05/&quot;&gt;아이템 관리&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;6강 - &lt;a href=&quot;https://blog.totu.dev/2017/02/21/azureandunity-06/&quot;&gt;자원 지급 관리&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;튜토리얼-제작-진행사항&quot;&gt;튜토리얼 제작 진행사항&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;7강 : … 시작도 못했는데 어쩌죠?&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;소식들&quot;&gt;소식들&lt;/h2&gt;
&lt;h3 id=&quot;웬디-근황&quot;&gt;웬디 근황&lt;/h3&gt;

&lt;p&gt;2월 21일. 웬디는 생일이었다.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/87OYm-cKeA8&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;blockquote&gt;
  &lt;p&gt;이렇게 좋고 행복한 일상만 보내라 웬디야!!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;좋은-소식&quot;&gt;좋은 소식&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://www.microsoft.com/korea/msdn/flash/archive/msdn_newsletter_1701.html&quot;&gt;MSDN 뉴스레터 2017년 1월&lt;/a&gt;에 강좌 소식이 소개되었다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msdn_newsletter_201701.png&quot; alt=&quot;뉴스레터인증샷&quot; width=&quot;300px&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;요리왕 류ㅎㅇ과장님 감사합니다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;그리고 &lt;code&gt;나는 프로그래머다&lt;/code&gt; 페이스북 페이지에도 소개되었다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/iamprogrammer_0224.png&quot; alt=&quot;나프다인증샷&quot; width=&quot;460px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;6강은 화요일(2월 21일 웬디 생일)에 &lt;a href=&quot;http://www.youtube.com/user/totuworld7/live&quot;&gt;유튜브 스트리밍&lt;/a&gt;으로 방송했다.&lt;/p&gt;

&lt;p&gt;4명이 소중한 분들이 있어서 힘이났다. 편집이 1시간 밖에 걸리지 않아서 너무 좋았다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;그래서 3월 7일 화요일 7강도 라이브로 진행하고 편집할 생각이다!!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;우울한-소식&quot;&gt;우울한 소식&lt;/h3&gt;

&lt;p&gt;유튜브 스트리밍에 앞서 대기중일 때 레드벨벳 신곡을 틀었다. 저작권을 침해한 내 잘못이다.&lt;/p&gt;

&lt;p&gt;그래서 &lt;code&gt;SM Ent&lt;/code&gt;로부터 경고를 득하게 되었다.&lt;/p&gt;

&lt;p&gt;다음 방송에서는 조심하고 또 조심해야겠다.&lt;/p&gt;

&lt;h2 id=&quot;맺음말&quot;&gt;맺음말&lt;/h2&gt;

&lt;p&gt;새로운 회사로 옮기는 시점이 2월 초였다. 진행이 어렵게되서 약속을 지키지 못하면 어쩌나 걱정했다.&lt;/p&gt;

&lt;p&gt;다행히 5, 6강 강을 약속한 날짜에 발행했다(나와의 약속?).&lt;/p&gt;

&lt;p&gt;1차 목표로 했던 7강까지 잘 마무리하길 바란다.&lt;/p&gt;

&lt;p&gt;그 이후는 어떤 기능을 필요로하는지 의견을 듣고 정리해서 진행해야겠다.&lt;/p&gt;
</description>
            <pubDate>Fri, 24 Feb 2017 21:00:00 +0900</pubDate>
            <link />https://blog.totu.dev/2017/02/24/wendynotification/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2017/02/24/wendynotification/</guid>
            
            
            <category>wendy</category>
            
        </item>
      
    
      
        <item>
            <title>이세계에 진입한 서버 개발 - 6</title>
            <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#들어가는-말&quot; id=&quot;markdown-toc-들어가는-말&quot;&gt;들어가는 말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#모델-추가&quot; id=&quot;markdown-toc-모델-추가&quot;&gt;모델 추가&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#라우터-추가&quot; id=&quot;markdown-toc-라우터-추가&quot;&gt;라우터 추가&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#appjs에-등록&quot; id=&quot;markdown-toc-appjs에-등록&quot;&gt;app.js에 등록&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#공통-사용-로직-추가&quot; id=&quot;markdown-toc-공통-사용-로직-추가&quot;&gt;공통 사용 로직 추가&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#자원-추가-메서드-incrementmaterials&quot; id=&quot;markdown-toc-자원-추가-메서드-incrementmaterials&quot;&gt;자원 추가 메서드 incrementMaterials&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#logicsrewardjs-추가&quot; id=&quot;markdown-toc-logicsrewardjs-추가&quot;&gt;logics/reward.js 추가&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#간단-테스트&quot; id=&quot;markdown-toc-간단-테스트&quot;&gt;간단 테스트&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#간단-테스트용-라우터-추가&quot; id=&quot;markdown-toc-간단-테스트용-라우터-추가&quot;&gt;간단 테스트용 라우터 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#데이터-입력&quot; id=&quot;markdown-toc-데이터-입력&quot;&gt;데이터 입력&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#즉시-지급-테스트&quot; id=&quot;markdown-toc-즉시-지급-테스트&quot;&gt;즉시 지급 테스트&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#쿠폰-제작&quot; id=&quot;markdown-toc-쿠폰-제작&quot;&gt;쿠폰 제작&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#쿠폰-모델-추가&quot; id=&quot;markdown-toc-쿠폰-모델-추가&quot;&gt;쿠폰 모델 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#쿠폰-라우터-추가&quot; id=&quot;markdown-toc-쿠폰-라우터-추가&quot;&gt;쿠폰 라우터 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#appjs에-등록-1&quot; id=&quot;markdown-toc-appjs에-등록-1&quot;&gt;app.js에 등록&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#테스트용-데이터-추가&quot; id=&quot;markdown-toc-테스트용-데이터-추가&quot;&gt;테스트용 데이터 추가&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#쿠폰-테스트&quot; id=&quot;markdown-toc-쿠폰-테스트&quot;&gt;쿠폰 테스트&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#맺음말&quot; id=&quot;markdown-toc-맺음말&quot;&gt;맺음말&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#참고자료&quot; id=&quot;markdown-toc-참고자료&quot;&gt;참고자료&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/ZSloWdCq4LY&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h2 id=&quot;들어가는-말&quot;&gt;들어가는 말&lt;/h2&gt;

&lt;p&gt;지난 시간에 아이템 관리까지 다루면서 게임 내 자원을 지급할 수 있는 기반이 마련되었다.&lt;/p&gt;

&lt;p&gt;이번 시간에는 자원을 지급하도록 해보겠다.&lt;/p&gt;

&lt;h2 id=&quot;모델-추가&quot;&gt;모델 추가&lt;/h2&gt;
&lt;p&gt;모델은 총 4개가 필요하다.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;models&lt;/code&gt; 폴더에 파일을 추가하고 각각 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.1/models/RewardSetGroup.js&quot;&gt;RewardSetGroup.js&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.1/models/RewardSet.js&quot;&gt;RewardSet.js&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.1/models/RewardGoodsGroup.js&quot;&gt;RewardGoodsGroup.js&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.1/models/RewardGoods.js&quot;&gt;RewardGoods.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;위 모델 중 가장 기본이 되는 것은 &lt;code&gt;RewardGoodsGroup&lt;/code&gt;과 &lt;code&gt;RewardGoods&lt;/code&gt;이다.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;RewardGoodsGroup&lt;/code&gt;에서 관리되는 &lt;code&gt;RewardGoodsGroupID&lt;/code&gt;를 통해 다수의 &lt;code&gt;RewardGoods&lt;/code&gt; 목록을 그룹으로 묶는다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy05_03.png&quot; alt=&quot;RewardGoodsGroup과RewardGoods의 관계&quot; width=&quot;250px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;이렇게 묶어두는 이유는 하나의 상품으로 다수의 자원이 지급될 수 있도록 하기 위함이다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;행운 상자라고 지칭한 뒤 최소 확율로 요원이 나오고 높은 확율로 골드 정도를 묶은 상품을 생각하면 된다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code&gt;RewardSetGroup&lt;/code&gt;은 &lt;code&gt;RewardSetGroupID&lt;/code&gt;를 통해 &lt;code&gt;RewardSet&lt;/code&gt;에 다수의 &lt;code&gt;RewardGoodsGroupID&lt;/code&gt;를 등록할 수 있는 형태이다.&lt;/p&gt;

&lt;p&gt;이렇게되면 묶음(패키지) 상품을 제공할 수 있다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;골드와 보석, 키 등이 한번에 포함된 상품을 제공하는 스타터 팩을 생각하면 된다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy05_04.png&quot; alt=&quot;RewardSetGroup과RewardSet의 관계&quot; width=&quot;500px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;단순한 묶음 상품이상으로 작동하도록 &lt;code&gt;RewardSet&lt;/code&gt;에도 드랍 확율을 넣었다. 묶음 상품 안에서 운이 좋으면 추가 재화를 얻을 수 있도록 말이다.&lt;/p&gt;

&lt;h2 id=&quot;라우터-추가&quot;&gt;라우터 추가&lt;/h2&gt;

&lt;p&gt;자원 세트(묶음 상품)와 지급 가능한 자원 정보를 추가하겠다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;GET /reward/set&lt;/li&gt;
  &lt;li&gt;GET /reward/goods&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;routes&lt;/code&gt;폴더에 &lt;code&gt;reward.js&lt;/code&gt;파일을 추가하고 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.1/routes/reward.js&quot;&gt;routes/reward.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;appjs에-등록&quot;&gt;app.js에 등록&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;app.js&lt;/code&gt; 파일을 수정하여 reward 라우터를 추가해보자.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;app.js&lt;/code&gt;에서 아래 내용을 찾아서 그 아래쪽에 코드를 추가한다.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;찾아야하는 내용&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  const routes = require(&#39;./routes/index&#39;);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;추가할 코드&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  const reward = require(&#39;./routes/reward&#39;);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;app.js&lt;/code&gt;에서 아래 내용을 찾아서 그 아래쪽에 코드를 추가한다.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;찾아야하는 내용&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  app.use(&#39;/&#39;, routes);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;추가할 코드&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  app.use(&#39;/reward&#39;, reward);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;공통-사용-로직-추가&quot;&gt;공통 사용 로직 추가&lt;/h2&gt;
&lt;p&gt;지금까지 모델을 추가했으며 간단한 2개의 API를 등록했다.&lt;/p&gt;

&lt;p&gt;이제 지급과 관련된 작업을 할 때 필요한 메서드를 추가하도록 하겠다.&lt;/p&gt;

&lt;h3 id=&quot;자원-추가-메서드-incrementmaterials&quot;&gt;자원 추가 메서드 incrementMaterials&lt;/h3&gt;

&lt;p&gt;지난 시간에 &lt;code&gt;logics/materialCtrl.js&lt;/code&gt;를 추가한 것이 기억나는가? 자원을 차감하는 메서드가 있었다.&lt;/p&gt;

&lt;p&gt;여기에 자원을 추가하는 메서드를 추가한다.&lt;/p&gt;

&lt;p&gt;다른 메서드와 겹치지 않게 &lt;code&gt;logics/materialCtrl.js&lt;/code&gt; 제일 아래쪽에 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;let incrementMaterial = (GameUserID, ItemID, Amount, NowMaxQNTY=null)=&amp;gt;{
    return models.DefineItem.findOne({
        where:{
            ItemID:ItemID
        }
    })
    .then((defineItem)=&amp;gt;{
        if(defineItem === null || defineItem === undefined)
            throw wendyError(&#39;UndefinedItem&#39;);

        switch(defineItem.ItemType) {
            case 10://통화 상품
                return incrementMaterialForCurrency(
                    GameUserID, ItemID, Amount, NowMaxQNTY);
                break;
            default ://특별한 정의가 없다면 모두 아이템을 처리한다.
                return incrementMaterialForItem(
                    GameUserID, defineItem, ItemID, Amount);
                break;
        }
    })
}

exports.incrementMaterial = incrementMaterial;

let createCurrency = (GameUserID, ItemID, Amount, defineCurrency=null, NowMaxQNTY=null)=&amp;gt;{
    let createObj = {
        GameUserID:GameUserID, 
        CurrencyID:ItemID,
        CurrentQNTY:Amount,
        NowMaxQNTY:NowMaxQNTY===null?100:NowMaxQNTY,
        UpdateTimeStamp:new Date()
    }

    return Promise.resolve()
    .then(()=&amp;gt;{
        if(NowMaxQNTY!==null)
            return Promise.reject(&#39;pass&#39;);
        return Promise.resolve();
    })
    .then(()=&amp;gt;{
        if( defineCurrency!==null )
            createObj.NowMaxQNTY = defineCurrency.MaxQNTY;
        return Promise.resolve();
    })
    .catch((err)=&amp;gt;{
        if(err &amp;amp;&amp;amp; err instanceof Error) {
            return Promise.reject(err);
        }
        else if(err===&#39;pass&#39;)
            return Promise.resolve();
    })
    .then(()=&amp;gt;{
        return models.OwnCurrency.create(createObj);
    })
}

let incrementMaterialForCurrency = (GameUserID, ItemID, Amount, NowMaxQNTY=null)=&amp;gt;{
    let defineCurrency = null;

    return models.DefineCurrency.findOne({where:{CurrencyID:ItemID}})
    .then((loadDefineCurrency)=&amp;gt;{
        if( !(loadDefineCurrency === null || loadDefineCurrency===undefined) )
            defineCurrency = loadDefineCurrency;
        return Promise.resolve();
    })
    .then(()=&amp;gt;{
        return models.OwnCurrency.findOne({
            where:{
                GameUserID:GameUserID, 
                CurrencyID:ItemID
            }})
    })
    .then((ownCurrency)=&amp;gt;{
        if(ownCurrency === null || ownCurrency === undefined)
            return createCurrency(
                GameUserID, 
                ItemID, 
                Amount, 
                defineCurrency,
                NowMaxQNTY);
        
        let incrementValue = (ownCurrency.CurrentQNTY + Amount);
        if(incrementValue&amp;gt;defineCurrency.MaxQNTY)
            incrementValue = defineCurrency.MaxQNTY;

        return models.OwnCurrency.update(
            { CurrentQNTY: incrementValue, UpdateTimeStamp: new Date() },
            { where: { OwnCurrencyUID: ownCurrency[&#39;OwnCurrencyUID&#39;] } }
        )
            .then(() =&amp;gt; {
                return models.OwnCurrency.findOne({
                    where: { OwnCurrencyUID: ownCurrency[&#39;OwnCurrencyUID&#39;] }
                })
            })
    })
    
}

let incrementMaterialForItem = (GameUserID, defineItem, ItemID, Amount)=&amp;gt;{
    return Promise.resolve()
    .then(()=&amp;gt;{
        if(defineItem.Multiple===false)
            return Promise.reject(&#39;create&#39;);
        return Promise.resolve();
    })
    .then(()=&amp;gt;{
        return models.OwnItem.findOne({where:{
            GameUserID:GameUserID,
            ItemID:ItemID
        }})
    })
    .then((ownItem)=&amp;gt;{
        if(ownItem === null || ownItem === undefined)
            return Promise.reject(&#39;create&#39;);
        
        let incrementValue = 
            (ownItem.CurrentQNTY + Amount)&amp;gt;defineItem.MaxQNTY
            ? defineItem.MaxQNTY - ownItem.CurrentQNTY
            : Amount;
        
        return ownItem.increment(&#39;CurrentQNTY&#39;, {by:incrementValue})
        .then(()=&amp;gt;{
            return models.OwnItem.findOne({where:{
                OwnItemID:ownItem[&#39;OwnItemUID&#39;]
            }})
        })
    })
    .catch((err)=&amp;gt;{
        if(err &amp;amp;&amp;amp; err instanceof Error) {
            return Promise.reject(err);
        }
        else if(err===&#39;create&#39;) {
            return models.OwnItem.create({
                GameUserID:GameUserID,
                ItemID:ItemID,
                CurrentQNTY:Amount,
                UpdateTimeStamp:new Date()
            });
        }
    })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;logicsrewardjs-추가&quot;&gt;logics/reward.js 추가&lt;/h3&gt;

&lt;p&gt;RewardSetGroup과 RewardGoodsGroup을 바탕으로 &lt;code&gt;logics/materialCtrl.js&lt;/code&gt;의 자원 추가 메서드로 자원을 지급하는 로직을 제작하겠다.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;logics/reward.js&lt;/code&gt; 파일을 추가한 뒤 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.3/logics/reward.js&quot;&gt;logics/reward.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;위 코드가 문제 없이 작동하려면 2가지를 더 추가해야한다.&lt;/p&gt;

&lt;p&gt;먼저 &lt;code&gt;utils/commonFunc.js&lt;/code&gt;에 아래 2가지 메서드를 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;/**
 * low와 high 사이의 숫자를 랜덤으로 리턴한다.
 * @returns {number}
 */
exports.RandomInt = (low, high)=&amp;gt;{
    return Math.floor(Math.random() * (high - low + 1) + low);
};

function async(makeGenerator) {
    return function () {
        let generator = makeGenerator.apply(this, arguments)

        function handle(result) { // { done: [Boolean], value: [Object] }
            if (result.done) return result.value

            return result.value.then(function (res) {
                return handle(generator.next(res))
            }, function (err) {
                return handle(generator.throw(err))
            })
        }

        return handle(generator.next())
    }
}

exports.async = async;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;그리고 에러코드를 추가한다. &lt;code&gt;utils/error.js&lt;/code&gt;에 아래 클래스를 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;/** 80611 */
class NotPresentRewardSetGroupID extends CustomError {
    constructor() {
        let message = &#39;RewardSetGroupID가 존재하지 않는다.&#39;;
        let code = 80611;
        super(message, code);
    }
}

/** 80612 */
class DidntRegisterRewardSet extends CustomError {
    constructor() {
        let message = &#39;RewardSetGroupID와 관련된 정보를 RewardSet에 등록하지 않았다.&#39;;
        let code = 80612;
        super(message, code);
    }
}


/** 80621 */
class NotPresentRewardGoodsGroupID extends CustomError {
    constructor() {
        let message = &#39;RewardGoodsGroupID가 존재하지 않는다.&#39;;
        let code = 80621;
        super(message, code);
    }
}

/** 80622 */
class DidntRegisterRewardGoods extends CustomError {
    constructor() {
        let message = &#39;RewardGoodsGroupID와 관련된 정보를 RewardGoods에 등록하지 않았다.&#39;;
        let code = 80622;
        super(message, code);
    }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;utils/error.js&lt;/code&gt;의 &lt;code&gt;errorMap&lt;/code&gt; 오브젝트에 추가할 클래스를 등록한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;추가할 때 이전의 마지막 부분 - 여기서는 NoLongerUpgrade - 에 콤마(,)를 추가하여야 한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;&quot;NotPresentRewardSetGroupID&quot;:NotPresentRewardSetGroupID,
&quot;DidntRegisterRewardSet&quot;:DidntRegisterRewardSet,

&quot;NotPresentRewardGoodsGroupID&quot;:NotPresentRewardGoodsGroupID,
&quot;DidntRegisterRewardGoods&quot;:DidntRegisterRewardGoods

&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;간단-테스트&quot;&gt;간단 테스트&lt;/h2&gt;
&lt;p&gt;지급 가능하도록 테이블에 데이터를 입력하고 실제 지급이 이뤄지는 테스트해보자.&lt;/p&gt;

&lt;h3 id=&quot;간단-테스트용-라우터-추가&quot;&gt;간단 테스트용 라우터 추가&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;이 내용은 앞서 routes/reward.js 를 추가할 때 이미 들어가있으므로 추가 하지 않는다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code&gt;routes/reward.js&lt;/code&gt; 하단에 아래 코드를 추가한다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;const env       = process.env.NODE_ENV || &quot;development&quot;;

if(env === &#39;development&#39;) {
    router.get(&#39;/test/:RewardGroupID&#39;, auth.isAuthenticated, (req, res, next)=&amp;gt;{

        rewardCtrl.paymentMaterial(req.user.GameUserID, req.params.RewardGroupID)
        .then((result)=&amp;gt;{
            res.send({result:0, reward:result});
        })
        .catch((err)=&amp;gt;{
            if(err === &#39;pass&#39;)
                res.send({result:0, reward:[]})
            else
                next(err);
        })
    });
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;환경변수 &lt;code&gt;NODE_ENV&lt;/code&gt;가 &lt;code&gt;development&lt;/code&gt;일 때만 사용가능도록 조치했다.&lt;/p&gt;

&lt;h3 id=&quot;데이터-입력&quot;&gt;데이터 입력&lt;/h3&gt;

&lt;p&gt;테스트를 진행하기 위해서는 총 4개 테이블에 데이터를 등록해야한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;DBeaver를 이용한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code&gt;RewardGoodsGroup&lt;/code&gt; 테이블에 데이터를 입력한다.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;RewardGoodsGroupID&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1011&lt;/td&gt;
      &lt;td&gt;NULL&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1012&lt;/td&gt;
      &lt;td&gt;NULL&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code&gt;RewardGoods&lt;/code&gt; 테이블에 데이터를 입력한다.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;RewardGoodsUID&lt;/th&gt;
      &lt;th&gt;AmountMin&lt;/th&gt;
      &lt;th&gt;AmountMax&lt;/th&gt;
      &lt;th&gt;DropRatio&lt;/th&gt;
      &lt;th&gt;ItemID&lt;/th&gt;
      &lt;th&gt;RewardGoodsGroupID&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;NULL&lt;/td&gt;
      &lt;td&gt;10&lt;/td&gt;
      &lt;td&gt;1000&lt;/td&gt;
      &lt;td&gt;0.9&lt;/td&gt;
      &lt;td&gt;103&lt;/td&gt;
      &lt;td&gt;1011&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;NULL&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;10&lt;/td&gt;
      &lt;td&gt;0.15&lt;/td&gt;
      &lt;td&gt;102&lt;/td&gt;
      &lt;td&gt;1011&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;NULL&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;0.05&lt;/td&gt;
      &lt;td&gt;2001&lt;/td&gt;
      &lt;td&gt;1011&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;NULL&lt;/td&gt;
      &lt;td&gt;10&lt;/td&gt;
      &lt;td&gt;100&lt;/td&gt;
      &lt;td&gt;0.1&lt;/td&gt;
      &lt;td&gt;102&lt;/td&gt;
      &lt;td&gt;1012&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code&gt;RewardSetGroup&lt;/code&gt; 테이블에 데이터를 입력한다.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;RewardSetGroupID&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;6001&lt;/td&gt;
      &lt;td&gt;NULL&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6002&lt;/td&gt;
      &lt;td&gt;NULL&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code&gt;RewardSet&lt;/code&gt; 테이블에 데이터를 입력한다.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;RewardSetUID&lt;/th&gt;
      &lt;th&gt;DropRatio&lt;/th&gt;
      &lt;th&gt;RewardGoodsGroupID&lt;/th&gt;
      &lt;th&gt;RewardSetGroupID&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;NULL&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1011&lt;/td&gt;
      &lt;td&gt;6001&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;NULL&lt;/td&gt;
      &lt;td&gt;0.5&lt;/td&gt;
      &lt;td&gt;1012&lt;/td&gt;
      &lt;td&gt;6001&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;NULL&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1012&lt;/td&gt;
      &lt;td&gt;6002&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;즉시-지급-테스트&quot;&gt;즉시 지급 테스트&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;패스 : GET&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;URL : localhost:3000/reward/test/6001&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Headers : Authorization을 추가하고 토큰 내용을 value 부분에 넣는다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;정상적으로 요청되면 아래와 같은 형식의 결과를 확인할 수 있다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-json&quot;&gt;{
  &quot;result&quot;: 0,
  &quot;reward&quot;: {
    &quot;item&quot;: [],
    &quot;currency&quot;: [
      {
        &quot;TotalQNTY&quot;: 900000,
        &quot;OwnCurrencyUID&quot;: 7,
        &quot;CurrencyID&quot;: 103,
        &quot;CurrentQNTY&quot;: 1217,
        &quot;NowMaxQNTY&quot;: 900000,
        &quot;AddMaxQNTY&quot;: 0,
        &quot;UpdateTimeStamp&quot;: &quot;2017-02-21T00:00:00.000Z&quot;,
        &quot;GameUserID&quot;: 1
      }
    ]
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;쿠폰-제작&quot;&gt;쿠폰 제작&lt;/h2&gt;

&lt;p&gt;자원을 지급할 수 있으면 제작가능한 기능이 많다.&lt;/p&gt;

&lt;p&gt;빨리 만들 수 있는 쿠폰을 제작해보도록 하겠다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy06_01.png&quot; alt=&quot;쿠폰&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;쿠폰-모델-추가&quot;&gt;쿠폰 모델 추가&lt;/h3&gt;

&lt;p&gt;쿠폰은 총 3개의 모델이 필요하다. &lt;code&gt;models&lt;/code&gt; 폴더에 파일을 추가하고 각각 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.2/models/DefineCoupon.js&quot;&gt;DefineCoupon.js&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.2/models/CouponQNTY.js&quot;&gt;CouponQNTY.js&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.2/models/LogCoupon.js&quot;&gt;LogCoupon.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;DefineCoupon&lt;/code&gt;은 쿠폰을 정의하고 &lt;code&gt;CouponQNTY&lt;/code&gt;는 정의된 쿠폰 중 수량만 별도로 적을 수 있도록 한다.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;DefineCoupon&lt;/code&gt;은 &lt;code&gt;RewardGoodsGroup&lt;/code&gt;이나 &lt;code&gt;RewardSetGroup&lt;/code&gt;의 ID를 이용해서 지급한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;이때 주의할 점은 둘 중 하나는 꼭 등록을해야 올바로 지급이 가능하다는 점이다. 관리자 도구 제작 시 참고한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/rvwendy06_02.png&quot; alt=&quot;DefineCoupon예시&quot; width=&quot;400px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;LogCoupon&lt;/code&gt;은 사용자의 쿠폰 사용 이력을 기록하여 중복 사용을 방지한다.&lt;/p&gt;

&lt;h3 id=&quot;쿠폰-라우터-추가&quot;&gt;쿠폰 라우터 추가&lt;/h3&gt;

&lt;p&gt;정의된 쿠폰 리스트를 요청할 수 있고 쿠폰을 사용할 수 있다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;GET /coupon/list&lt;/li&gt;
  &lt;li&gt;POST /coupon/use/:CouponName&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;routes&lt;/code&gt;폴더에 &lt;code&gt;coupon.js&lt;/code&gt;파일을 추가하고 아래 내용을 적용한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/totuworld/Wendy/tuto6.2/routes/coupon.js&quot;&gt;routes/coupon.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;쿠폰 사용부분이 조금 복잡하게 되어있을 것이다. 중복 사용이 불가능하도록 해야하고 유효한 쿠폰인지 검증하는 부분이 많아서 그렇다.&lt;/p&gt;

&lt;p&gt;단순하게 절차를 나타내면 아래처럼 진행된다.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;유효한 쿠폰인지 검증&lt;/li&gt;
  &lt;li&gt;쿠폰 사용 기록&lt;/li&gt;
  &lt;li&gt;자원 지급&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;appjs에-등록-1&quot;&gt;app.js에 등록&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;app.js&lt;/code&gt; 파일을 수정하여 coupon 라우터를 추가해보자.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;app.js&lt;/code&gt;에서 아래 내용을 찾아서 그 아래쪽에 코드를 추가한다.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;찾아야하는 내용&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  const routes = require(&#39;./routes/index&#39;);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;추가할 코드&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  const coupon = require(&#39;./routes/coupon&#39;);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;app.js&lt;/code&gt;에서 아래 내용을 찾아서 그 아래쪽에 코드를 추가한다.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;찾아야하는 내용&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  app.use(&#39;/&#39;, routes);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;추가할 코드&lt;/p&gt;

        &lt;pre&gt;&lt;code&gt;  app.use(&#39;/coupon&#39;, coupon);
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;테스트용-데이터-추가&quot;&gt;테스트용 데이터 추가&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;CouponQNTY&lt;/code&gt; 테이블에 데이터를 입력한다.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;CouponQNTYID&lt;/th&gt;
      &lt;th&gt;CurrentQNTY&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;10&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code&gt;DefineCoupon&lt;/code&gt; 테이블에 데이터를 입력한다.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;CouponID&lt;/th&gt;
      &lt;th&gt;CouponName&lt;/th&gt;
      &lt;th&gt;ExpiredDate&lt;/th&gt;
      &lt;th&gt;CouponQNTYID&lt;/th&gt;
      &lt;th&gt;RewardSetGroupID&lt;/th&gt;
      &lt;th&gt;RewardGoodsGroupID&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;test&lt;/td&gt;
      &lt;td&gt;2017-02-24&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;1011&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code&gt;CouponQNTYID&lt;/code&gt;는 반드시 앞서 CouponQNTY 테이블에 등록된 CouponQNTYID를 확인하여 올바로 입력한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;쿠폰-테스트&quot;&gt;쿠폰 테스트&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;패스 : POST&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;URL : localhost:3000/coupon/use/test&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Headers : Authorization을 추가하고 토큰 내용을 value 부분에 넣는다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;요청이 올바르면 앞서 살펴본 &lt;code&gt;즉시 지급 테스트&lt;/code&gt;와 유사한 결과를 얻을 수 있다.&lt;/p&gt;

&lt;h2 id=&quot;맺음말&quot;&gt;맺음말&lt;/h2&gt;

&lt;p&gt;아직 관리자 도구가 없어서 운영까지는 불가능하지만 어쨌든 Wendy에 쿠폰까지 제작해봤다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;쿠폰은 1차 제작 범위 안에 없었는데 만들다보니 들어갔다. 서비스~ 서비스~&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;다음 강좌는 인앱 영수증 검증부분이다. 영수증을 검증하는 부분을 제외하면 자원 지급을 그대로 사용하므로 비교적 간단하다.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.totu.dev/2017/03/07/azureandunity-07/&quot;&gt;7강 바로가기&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;참고자료&quot;&gt;참고자료&lt;/h2&gt;
&lt;p&gt;완성된 소스코드는 아래 링크에서 다운로드받으면 된다.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/totuworld/Wendy/archive/0.0.5.zip&quot;&gt;Wendy 6강 완료 버전&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Tue, 21 Feb 2017 04:01:00 +0900</pubDate>
            <link />https://blog.totu.dev/2017/02/21/azureandunity-06/&lt;/link&gt;
            <guid isPermaLink="true">https://blog.totu.dev/2017/02/21/azureandunity-06/</guid>
            
            
            <category>nodejs</category>
            
            <category>azure</category>
            
            <category>webapps</category>
            
            <category>unity</category>
            
        </item>
      
    
  </channel>
</rss>
